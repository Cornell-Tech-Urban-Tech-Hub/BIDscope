import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{R as Q,r as l}from"./index.6otl1p8d.js";import{a as K}from"./maplibre-gl.BIyHGNM8.js";import{MapboxOverlay as X}from"./index.Bg-cVQ5Q.js";import{GeoJsonLayer as T}from"./index.BnauiKoP.js";import"./webgl-device.DkQLLCya.js";const D=Q.memo(({deployment:n,isVisible:r=!0,onClose:i})=>{const u=`https://www.youtube-nocookie.com/embed/${n.videoId}?start=${n.startTime}&end=${n.endTime}&rel=0&modestbranding=1&autoplay=1&enablejsapi=1`,S=l.useRef(null);return l.useEffect(()=>{const d=S.current;d&&(r?d.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*"):d.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"))},[r]),r?e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium",children:n.name}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700",children:"✕"})]})}),e.jsx("div",{className:"relative aspect-video",children:e.jsx("iframe",{ref:S,src:`${u}&origin=${window.location.origin}`,title:n.name,className:"w-full h-full",style:{minHeight:"200px"},frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,sandbox:"allow-same-origin allow-scripts allow-presentation allow-popups allow-popups-to-escape-sandbox"},`${n.videoId}-${n.startTime}`)})]}):null}),v=[[165,0,38],[215,48,39],[244,109,67],[253,174,97],[254,224,144],[255,255,191],[217,239,139],[166,217,106],[102,189,99],[26,152,80],[0,104,55]],g={"Elmhurst, Queens":{coords:[40.738536,-73.887267],videoId:"o52MZ1AHyjA",startTime:44,endTime:62},"Sutton Place, Manhattan":{coords:[40.75889,-73.958457],videoId:"o52MZ1AHyjA",startTime:21,endTime:43},"Herald Square, Manhattan":{coords:[40.748422,-73.988275],videoId:"o52MZ1AHyjA",startTime:63,endTime:83},"Jackson Heights, Queens":{coords:[40.747379,-73.88969],videoId:"o52MZ1AHyjA",startTime:85,endTime:100}},ee={sidewalkScores:"Sidewalk Scores",censusBlocks:"Census Blocks",deploymentLocations:"Deployment Locations"},k=()=>{const n=l.useRef(null),[r,i]=l.useState(null),[u,S]=l.useState(null),[d,P]=l.useState(null),[h,A]=l.useState(!0),w=l.useRef(null),f=l.useRef(null),[L,$]=l.useState(0),[x,F]=l.useState({sidewalks:null,censusBlocks:null}),[y,B]=l.useState({sidewalkScores:!0,censusBlocks:!0,deploymentLocations:!0}),[O,U]=l.useState(""),[c,N]=l.useState(null);l.useEffect(()=>{const t=()=>{w.current&&$(w.current.offsetWidth)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),l.useEffect(()=>{if(!n.current)return;const t=new K.Map({container:n.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[-73.9712,40.7831],zoom:12,pitch:45,bearing:0});return t.on("style.load",()=>{const s=t.getStyle().layers.find(o=>o.type==="symbol"||o.id.includes("label")||o.id.includes("place"));P(s.id)}),i(t),()=>{t.remove()}},[]),l.useEffect(()=>{if(!r)return;if(!f.current){const s=document.createElement("div");s.style.display="none",s.style.position="absolute",s.style.pointerEvents="none",s.style.zIndex="100",s.style.backgroundColor="white",s.style.padding="8px 12px",s.style.borderRadius="6px",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.body.appendChild(s),f.current=s}const t=new X({interleaved:!0,layers:[],onHover:s=>{const o=f.current;if(o)if(s.object){const a=s.x+(h?L:0),m=s.y;o.style.display="block",o.style.left=`${a}px`,o.style.top=`${m}px`,o.style.transform="translate(-50%, -100%)",o.style.marginTop="-10px",s.layer.id==="deployment-zones"&&s.object.properties?.name?o.innerHTML=`
              <div class="font-semibold">${s.object.properties.name}</div>
              <div class="text-sm text-gray-600">Click to view deployment</div>
            `:s.layer.id==="sidewalks"&&s.object.properties?.score&&(o.innerHTML=`Score: ${(s.object.properties.score*100).toFixed(1)}%`)}else o.style.display="none"}});return r.addControl(t),S(t),()=>{f.current&&(document.body.removeChild(f.current),f.current=null),r.removeControl(t)}},[r,h,L]),l.useEffect(()=>{(async()=>{try{const s=document.querySelector('meta[name="astro:base"]')?.getAttribute("content")||"",o=s?`${s}/src/components/groups/_matt_demo/sidewalks.geojson`:"/src/components/groups/_matt_demo/sidewalks.geojson",a=s?`${s}/src/components/groups/_matt_demo/census.geojson`:"/src/components/groups/_matt_demo/census.geojson";console.log(`Loading data from: ${o} and ${a}`);const[m,p]=await Promise.all([fetch(o),fetch(a)]);if(!m.ok)throw new Error(`Failed to load sidewalks data: ${m.status} ${m.statusText}`);if(!p.ok)throw new Error(`Failed to load census data: ${p.status} ${p.statusText}`);const[b,j]=await Promise.all([m.json(),p.json()]);console.log("Data loaded successfully"),F({sidewalks:b,censusBlocks:j})}catch(s){console.error("Error loading map data:",s)}})()},[]);const I=l.useCallback(()=>{const t=[];return Object.entries(g).forEach(([m,p])=>{for(let b=0;b<15;b++){const j=b/14,W=Math.cos(j*Math.PI/2)*.004,Y=Math.sin(j*Math.PI/2)*250,H=32,z=[];for(let M=0;M<=H;M++){const V=M/H*Math.PI*2,q=p.coords[1]+Math.cos(V)*W,J=p.coords[0]+Math.sin(V)*W;z.push([q,J])}t.push({type:"Feature",properties:{name:m,video:p.video,height:Y,opacity:.3*(1-j),level:b},geometry:{type:"Polygon",coordinates:[z]}})}}),{type:"FeatureCollection",features:t}},[]),Z=l.useCallback(t=>{if(t&&g[t]){const[s,o]=g[t].coords;if(!c||c.name!==t){const a=g[t];N({name:t,videoId:a.videoId,startTime:a.startTime,endTime:a.endTime})}r?.flyTo({center:[o,s],zoom:16,duration:2e3,pitch:60})}},[r,c]),E=l.useCallback(({object:t})=>{if(t?.properties?.name){const s=t.properties.name,o=g[s];o&&(!c||c.name!==s)&&(N({name:s,videoId:o.videoId,startTime:o.startTime,endTime:o.endTime}),r?.flyTo({center:[o.coords[1],o.coords[0]],zoom:16,duration:2e3,pitch:60}))}},[r,c]);l.useEffect(()=>{if(!u||!x.sidewalks||!d)return;const t=[];y.censusBlocks&&x.censusBlocks&&t.push(new T({id:"census-blocks",data:x.censusBlocks,pickable:!1,stroked:!0,filled:!1,lineWidthScale:3,getLineColor:[100,100,100,100],beforeId:d})),y.deploymentLocations&&t.push(new T({id:"deployment-zones",data:I(),pickable:!0,onClick:E,stroked:!1,filled:!0,extruded:!0,wireframe:!1,getElevation:s=>s.properties.height,getFillColor:s=>[0,128,255,255*s.properties.opacity],parameters:{depthTest:!1,depthMask:!0,zIndex:2,blend:!0,blendFunc:[WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA]}})),y.sidewalkScores&&x.sidewalks&&t.push(new T({id:"sidewalks",data:x.sidewalks,pickable:!0,stroked:!0,filled:!0,lineWidthScale:12,beforeId:d,getLineColor:s=>{const o=s.properties?.score??0,a=Math.floor(o*2.5*(v.length-1));return[v[a],255]},getFillColor:s=>{const o=s.properties?.score??0,a=Math.floor(o*(v.length-1));return[...v[a],255]},parameters:{depthTest:!1,zIndex:1}})),u.setProps({layers:t})},[u,x,y,r,d,I,E]);const G=l.useCallback(()=>{A(t=>!t),setTimeout(()=>{w.current&&$(w.current.offsetWidth)},300)},[]),_=l.useCallback(()=>{N(null)},[]);return e.jsxs("div",{className:"h-screen w-full flex flex-col lt-md:flex-col md:flex-row relative",style:{minHeight:"500px"},children:[e.jsxs("a",{href:"/",className:`
          absolute top-4 right-4
          flex flex-col items-center
          bg-white rounded-lg p-2 shadow-lg z-30
        `,children:[e.jsx("img",{src:"/src/components/groups/_matt_demo/trashbot.png",alt:"Home",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("span",{className:"poppins text-sm mt-1",children:"Home"})]}),e.jsxs("div",{ref:w,className:`
          absolute left-0 top-0
          md:h-full lt-md:h-auto 
          bg-white shadow-lg z-10
          transition-all duration-300
          lt-md:w-full
          md:w-[32rem]
          ${h?"":"md:-translate-x-full"}
        `,children:[e.jsx("button",{onClick:G,className:`
            md:block lt-md:hidden
            absolute -right-14 top-4
            bg-white rounded-lg p-2
            shadow-lg z-30
          `,children:e.jsx("span",{className:"poppins text-xl",children:h?"←":"→"})}),e.jsxs("div",{className:`
          p-4 overflow-x-hidden
          transition-all duration-300
          ${h?"md:opacity-100 md:visible md:w-auto md:translate-x-0":"md:opacity-0 md:invisible md:w-0 md:-translate-x-full"}
        `,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"poppins text-xl font-semibold italic mb-4",children:"Robotability Proof-of-Concept"}),e.jsx("p",{className:"poppins mb-4",children:"New York City, September 2024"}),e.jsxs("select",{className:"poppins w-full p-2 border rounded",value:O,onChange:t=>{U(t.target.value),t.target.value?Z(t.target.value):N(null)},children:[e.jsx("option",{value:"",children:"Select Deployment"}),Object.keys(g).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"poppins text-lg font-semibold mb-2",children:"Layers"}),e.jsx("div",{className:`
              flex flex-wrap gap-4 
              lt-md:justify-start md:flex-col
            `,children:Object.entries(y).map(([t,s])=>e.jsxs("label",{className:`
                    poppins flex items-center 
                    lt-md:w-[calc(50%-0.5rem)] md:w-full
                  `,children:[e.jsx("input",{type:"checkbox",checked:s,onChange:()=>{B(o=>({...o,[t]:!o[t]}))},className:"mr-2"}),ee[t]]},t))})]}),e.jsxs("div",{className:"lt-md:hidden md:block mb-8",children:[e.jsx("h4",{className:"poppins text-lg font-semibold mb-2",children:"Score Legend"}),e.jsx("div",{className:"bg-gray-100 p-4 rounded flex flex-wrap justify-center gap-1",children:v.map((t,s)=>e.jsx("div",{className:"w-5 h-5",style:{backgroundColor:`rgb(${t.join(",")})`}},s))}),e.jsx("p",{className:"poppins text-center mt-2",children:"Low Percentile → High Percentile"})]}),c&&e.jsx("div",{className:"lt-md:hidden md:block mt-8",children:e.jsx(D,{deployment:c,isVisible:h&&window.innerWidth>=768,onClose:_})})]})]}),e.jsx("div",{className:`
        relative
        transition-all duration-300
        ${h?"md:w-[calc(100%-32rem)] md:ml-[32rem]":"md:w-full"}
        lt-md:w-full
        lt-md:flex-1
      `,style:{minHeight:"500px"},children:e.jsx("div",{ref:n,className:"absolute inset-0",style:{width:"100%",height:"100%",minHeight:"500px"}})}),c&&e.jsx("div",{className:`
          lt-md:block md:hidden
          w-full bg-white shadow-lg
          border-t border-gray-200
          h-auto max-h-[40vh]
          z-20
        `,children:e.jsx(D,{deployment:c,isVisible:window.innerWidth<768,onClose:_})})]})};function C(){return e.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center gap-6 my-8",children:[e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx("img",{src:"/west_village/street_view1.png",alt:"West Village Street View",style:{width:"100%",maxWidth:"650px",borderRadius:"12px",objectFit:"cover"}})}),e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx("iframe",{src:"https://www.arcgis.com/apps/mapviewer/index.html?webmap=3d35ca6bff6243c19dd4e53f9d176b49",width:"100%",height:"500",style:{border:"1px solid #ccc",borderRadius:"12px"},allowFullScreen:!0,loading:"lazy"})})]})}const R={RobotabilityMap:k,"_matt_demo/RobotabilityMap":k,"groups/_matt_demo/RobotabilityMap":k,"src/components/groups/_matt_demo/RobotabilityMap":k,"src/components/groups/_matt_demo/RobotabilityMap.jsx":k,WestVillageStreetView:C,"visualizations/WestVillageStreetView":C,"src/components/visualizations/WestVillageStreetView":C,"src/components/visualizations/WestVillageStreetView.jsx":C},te=({src:n})=>n.includes("youtube.com/embed/")?e.jsx("div",{className:"aspect-video w-full",children:e.jsx("iframe",{src:n,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full border-0"})}):e.jsxs("p",{children:["Unsupported external component: ",n]});function se(n){if(n.startsWith("http"))return u=>e.jsx(te,{src:n,...u});const r=n.replace(/^\/components\//,"").replace(/^src\/components\//,"").replace(/^\/src\/components\//,""),i=R[n]||R[r]||R[r.replace(/\.jsx$/,"")]||R[r.split("/").pop().replace(/\.jsx$/,"")];return i||(console.warn(`Component not found in registry: ${n}`),()=>e.jsxs("p",{className:"error-message",children:["Component not found: ",n]}))}const ce=({componentPath:n,...r})=>{if(!n)return e.jsx("div",{className:"error-message",children:"No component path provided"});try{const i=se(n);return e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"loading",children:"Loading component..."}),children:e.jsx(i,{...r})})}catch(i){return console.error("Error loading component:",i),e.jsxs("div",{className:"error-message",children:[e.jsxs("p",{children:["Error loading component: ",n]}),e.jsx("p",{children:i.message})]})}};export{ce as default};
