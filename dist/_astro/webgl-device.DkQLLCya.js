function Rr(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Ds=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Er=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Er&&parseFloat(Er[1]);const Sr=globalThis,br=globalThis.process||{},Zi=globalThis.navigator||{};function Bs(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function Ce(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Bs()}function qi(e){return Ce()?Bs()?"Electron":(Zi.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const ws="4.1.0";function Qi(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}class Ji{constructor(t,r,s="sessionStorage"){this.storage=Qi(s),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){const r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}function Gi(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function en(e,t=8){const r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var Ze;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ze||(Ze={}));const tn=10;function Cr(e){return typeof e!="string"?e:(e=e.toUpperCase(),Ze[e]||Ze.WHITE)}function rn(e,t,r){return!Ce&&typeof e=="string"&&(t&&(e=`\x1B[${Cr(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${Cr(r)+tn}m${e}\x1B[49m`)),e}function sn(e,t=["constructor"]){const r=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(r),i=e;for(const n of s){const o=i[n];typeof o=="function"&&(t.find(a=>n===a)||(i[n]=o.bind(e)))}}function Qt(e,t){if(!e)throw new Error("Assertion failed")}function le(){let e;if(Ce()&&Sr.performance)e=Sr?.performance?.now?.();else if("hrtime"in br){const t=br?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const fe={debug:Ce()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nn={enabled:!0,level:0};function he(){}const Mr={},Ir={once:!0};class ve{constructor({id:t}={id:""}){this.VERSION=ws,this._startTs=le(),this._deltaTs=le(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Ji(`__probe-${this.id}__`,nn),this.timeStamp(`${this.id} started`),sn(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((le()-this._startTs).toPrecision(10))}getDelta(){return Number((le()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,fe.warn,arguments,Ir)}error(t){return this._getLogFunction(0,t,fe.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,fe.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,fe.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,fe.debug||fe.info,arguments,Ir)}table(t,r,s){return r?this._getLogFunction(t,r,console.table||he,s&&[s],{tag:an(r)}):he}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||he)}group(t,r,s={collapsed:!1}){const i=Nr({logLevel:t,message:r,opts:s}),{collapsed:n}=s;return i.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,r,s={}){return this.group(t,r,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||he)}withGroup(t,r,s){this.group(t,r)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=xs(t)}_getLogFunction(t,r,s,i,n){if(this._shouldLog(t)){n=Nr({logLevel:t,message:r,args:i,opts:n}),s=s||n.method,Qt(s),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=le();const o=n.tag||n.message;if(n.once&&o)if(!Mr[o])Mr[o]=le();else return he;return r=on(this.id,n.message,n),s.bind(console,r,...n.args)}return he}}ve.VERSION=ws;function xs(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Qt(Number.isFinite(t)&&t>=0),t}function Nr(e){const{logLevel:t,message:r}=e;e.logLevel=xs(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&s.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const i=typeof e.message;return Qt(i==="string"||i==="object"),Object.assign(e,{args:s},e.opts)}function on(e,t,r){if(typeof t=="string"){const s=r.time?en(Gi(r.total)):"";t=r.time?`${e}: ${s}  ${t}`:`${e}: ${t}`,t=rn(t,r.color,r.background)}return t}function an(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}const Tt="4.3.2",cn=Tt[0]>="0"&&Tt[0]<="9"?`v${Tt}`:"";function ln(){const e=new ve({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=cn,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const fn=ln();function hn(e,t){return Us(e||{},t)}function Us(e,t,r=0){if(r>3)return t;const s={...e};for(const[i,n]of Object.entries(t))n&&typeof n=="object"&&!Array.isArray(n)?s[i]=Us(s[i]||{},t[i],r+1):s[i]=t[i];return s}const _n="latest";function dn(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const un=dn();function ee(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const re=typeof process!="object"||String(process)!=="[object process]"||process.browser,gn=typeof window<"u"&&typeof window.orientation<"u",Or=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Or&&parseFloat(Or[1]);class Tn{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((s,i)=>{this._resolve=s,this._reject=i})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){ee(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){ee(this.isRunning),this.isRunning=!1,this._reject(t)}}class At{terminate(){}}const pt=new Map;function An(e){ee(e.source&&!e.url||!e.source&&e.url);let t=pt.get(e.source||e.url);return t||(e.url&&(t=pn(e.url),pt.set(e.url,t)),e.source&&(t=vs(e.source),pt.set(e.source,t))),ee(t),t}function pn(e){if(!e.startsWith("http"))return e;const t=Rn(e);return vs(t)}function vs(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Rn(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Ws(e,t=!0,r){const s=r||new Set;if(e){if(yr(e))s.add(e);else if(yr(e.buffer))s.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const i in e)Ws(e[i],t,s)}}return r===void 0?Array.from(s):[]}function yr(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Rt=()=>{};class kt{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&re||typeof At<"u"&&!re}constructor(t){const{name:r,source:s,url:i}=t;ee(s||i),this.name=r,this.source=s,this.url=i,this.onMessage=Rt,this.onError=n=>console.log(n),this.worker=re?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Rt,this.onError=Rt,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||Ws(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=An({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new At(s,{eval:!1})}else if(this.source)t=new At(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}}class En{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return kt.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(i,n,o)=>i.done(o),s=(i,n)=>i.error(n)){const i=new Promise(n=>(this.jobQueue.push({name:t,onMessage:r,onError:s,onStart:n}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});const s=new Tn(r.name,t);t.onMessage=i=>r.onMessage(s,i.type,i.payload),t.onError=i=>r.onError(s,i),r.onStart(s);try{await s.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!re||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new kt({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return gn?this.maxMobileConcurrency:this.maxConcurrency}}const Sn={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class G{props;workerPools=new Map;static _workerFarm;static isSupported(){return kt.isSupported()}static getWorkerFarm(t={}){return G._workerFarm=G._workerFarm||new G({}),G._workerFarm.setProps(t),G._workerFarm}constructor(t){this.props={...Sn},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:r,source:s,url:i}=t;let n=this.workerPools.get(r);return n||(n=new En({name:r,source:s,url:i}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function bn(e,t={}){const r=t[e.id]||{},s=re?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let i=r.workerUrl;if(!i&&e.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(re?i=`modules/${e.module}/dist/${s}`:i=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let n=e.version;n==="latest"&&(n=_n);const o=n?`@${n}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${s}`}return ee(i),i}function Cn(e,t=un){ee(e,"no worker provided");const r=e.version;return!(!t||!r)}function Mn(e,t){return!G.isSupported()||!re&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function In(e,t,r,s,i){const n=e.id,o=bn(e,r),c=G.getWorkerFarm(r).getWorkerPool({name:n,url:o});r=JSON.parse(JSON.stringify(r)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",Nn.bind(null,i));return l.postMessage("process",{input:t,options:r,context:s}),await(await l.result).result}async function Nn(e,t,r,s){switch(r){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:i,input:n,options:o}=s;try{const a=await e(n,o);t.postMessage("done",{id:i,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:i,error:c})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function On(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const s=new Uint8Array(e),i=new Uint8Array(t);for(let n=0;n<s.length;++n)if(s[n]!==i[n])return!1;return!0}function yn(...e){return Pn(e)}function Pn(e){const t=e.map(n=>n instanceof ArrayBuffer?new Uint8Array(n):n),r=t.reduce((n,o)=>n+o.byteLength,0),s=new Uint8Array(r);let i=0;for(const n of t)s.set(n,i),i+=n.byteLength;return s.buffer}async function Fn(e){const t=[];for await(const r of e)t.push(r);return yn(...t)}function Pr(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class Fr{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Pr(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Pr()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class mn{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const r of Object.values(this.stats))t(r)}getTable(){const t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){const{name:r,type:s}=t;let i=this.stats[r];return i||(t instanceof Fr?i=t:i=new Fr(r,s),this.stats[r]=i),i}}let Dn="";const mr={};function Bn(e){for(const t in mr)if(e.startsWith(t)){const r=mr[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Dn}${e}`),e}function wn(e){return e&&typeof e=="object"&&e.isBuffer}function ks(e){if(wn(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Hs(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function xn(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const Un=e=>typeof e=="boolean",Be=e=>typeof e=="function",We=e=>e!==null&&typeof e=="object",Dr=e=>We(e)&&e.constructor==={}.constructor,vn=e=>!!e&&typeof e[Symbol.iterator]=="function",Wn=e=>e&&typeof e[Symbol.asyncIterator]=="function",ae=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,ce=e=>typeof Blob<"u"&&e instanceof Blob,kn=e=>e&&typeof e=="object"&&e.isBuffer,Hn=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||We(e)&&Be(e.tee)&&Be(e.cancel)&&Be(e.getReader),Xn=e=>We(e)&&Be(e.read)&&Be(e.pipe)&&Un(e.readable),Xs=e=>Hn(e)||Xn(e);class Vn extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const jn=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,zn=/^([-\w.]+\/[-\w.+]+)/;function Br(e,t){return e.toLowerCase()===t.toLowerCase()}function $n(e){const t=zn.exec(e);return t?t[1]:e}function wr(e){const t=jn.exec(e);return t?t[1]:""}const Vs=/\?.*/;function Ln(e){const t=e.match(Vs);return t&&t[0]}function Jt(e){return e.replace(Vs,"")}function Yn(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function ft(e){return ae(e)?e.url:ce(e)?e.name||"":typeof e=="string"?e:""}function Gt(e){if(ae(e)){const t=e,r=t.headers.get("content-type")||"",s=Jt(t.url);return $n(r)||wr(s)}return ce(e)?e.type||"":typeof e=="string"?wr(e):""}function Kn(e){return ae(e)?e.headers["content-length"]||-1:ce(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function js(e){if(ae(e))return e;const t={},r=Kn(e);r>=0&&(t["content-length"]=String(r));const s=ft(e),i=Gt(e);i&&(t["content-type"]=i);const n=await Qn(e);n&&(t["x-first-bytes"]=n),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function Zn(e){if(!e.ok)throw await qn(e)}async function qn(e){const t=Yn(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;const s={reason:e.statusText,url:e.url,response:e};try{const i=e.headers.get("Content-Type");s.reason=!e.bodyUsed&&i?.includes("application/json")?await e.json():await e.text()}catch{}return new Vn(r,s)}async function Qn(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const r=e.slice(0,5);return await new Promise(s=>{const i=new FileReader;i.onload=n=>s(n?.target?.result),i.readAsDataURL(r)})}if(e instanceof ArrayBuffer){const r=e.slice(0,5);return`data:base64,${Jn(r)}`}return null}function Jn(e){let t="";const r=new Uint8Array(e);for(let s=0;s<r.byteLength;s++)t+=String.fromCharCode(r[s]);return btoa(t)}function Gn(e){return!eo(e)&&!to(e)}function eo(e){return e.startsWith("http:")||e.startsWith("https:")}function to(e){return e.startsWith("data:")}async function xr(e,t){if(typeof e=="string"){const r=Bn(e);return Gn(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await js(e)}const Ur=new ve({id:"loaders.gl"});class ro{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class so{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const zs={fetch:null,mimeType:void 0,nothrow:!1,log:new so,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ds,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},io={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function $s(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Ls(){const e=$s();return e.globalOptions=e.globalOptions||{...zs},e.globalOptions}function no(e,t,r,s){return r=r||[],r=Array.isArray(r)?r:[r],oo(e,r),co(t,e,s)}function oo(e,t){vr(e,null,zs,io,t);for(const r of t){const s=e&&e[r.id]||{},i=r.options&&r.options[r.id]||{},n=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};vr(s,r.id,i,n,t)}}function vr(e,t,r,s,i){const n=t||"Top level",o=t?`${t}.`:"";for(const a in e){const c=!t&&We(e[a]),l=a==="baseUri"&&!t,f=a==="workerUrl"&&t;if(!(a in r)&&!l&&!f){if(a in s)Ur.warn(`${n} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=ao(a,i);Ur.warn(`${n} loader option '${o}${a}' not recognized. ${h}`)()}}}}function ao(e,t){const r=e.toLowerCase();let s="";for(const i of t)for(const n in i.options){if(e===n)return`Did you mean '${i.id}.${n}'?`;const o=n.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(s=s||`Did you mean '${i.id}.${n}'?`)}return s}function co(e,t,r){const i={...e.options||{}};return lo(i,r),i.log===null&&(i.log=new ro),Wr(i,Ls()),Wr(i,t),i}function Wr(e,t){for(const r in t)if(r in t){const s=t[r];Dr(s)&&Dr(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function lo(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function er(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function tr(e){Rr(e,"null loader"),Rr(er(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Ys=()=>{const e=$s();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Yh(e){const t=Ys();e=Array.isArray(e)?e:[e];for(const r of e){const s=tr(r);t.find(i=>s===i)||t.unshift(s)}}function fo(){return Ys()}const ho=/\.([^.]+)$/;async function _o(e,t=[],r,s){if(!Ks(e))return null;let i=kr(e,t,{...r,nothrow:!0},s);if(i)return i;if(ce(e)&&(e=await e.slice(0,10).arrayBuffer(),i=kr(e,t,r,s)),!i&&!r?.nothrow)throw new Error(Zs(e));return i}function kr(e,t=[],r,s){if(!Ks(e))return null;if(t&&!Array.isArray(t))return tr(t);let i=[];t&&(i=i.concat(t)),r?.ignoreRegisteredLoaders||i.push(...fo()),go(i);const n=uo(e,i,r,s);if(!n&&!r?.nothrow)throw new Error(Zs(e));return n}function uo(e,t,r,s){const i=ft(e),n=Gt(e),o=Jt(i)||s?.url;let a=null,c="";return r?.mimeType&&(a=Et(t,r?.mimeType),c=`match forced by supplied MIME type ${r?.mimeType}`),a=a||To(t,o),c=c||(a?`matched url ${o}`:""),a=a||Et(t,n),c=c||(a?`matched MIME type ${n}`:""),a=a||po(t,e),c=c||(a?`matched initial data ${qs(e)}`:""),r?.fallbackMimeType&&(a=a||Et(t,r?.fallbackMimeType),c=c||(a?`matched fallback MIME type ${n}`:"")),c&&fn.log(1,`selectLoader selected ${a?.name}: ${c}.`),a}function Ks(e){return!(e instanceof Response&&e.status===204)}function Zs(e){const t=ft(e),r=Gt(e);let s="No valid loader found (";s+=t?`${Hs(t)}, `:"no url provided, ",s+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=e?qs(e):"";return s+=i?` first bytes: "${i}"`:"first bytes: not available",s+=")",s}function go(e){for(const t of e)tr(t)}function To(e,t){const r=t&&ho.exec(t),s=r&&r[1];return s?Ao(e,s):null}function Ao(e,t){t=t.toLowerCase();for(const r of e)for(const s of r.extensions)if(s.toLowerCase()===t)return r;return null}function Et(e,t){for(const r of e)if(r.mimeTypes?.some(s=>Br(t,s))||Br(t,`application/x.${r.id}`))return r;return null}function po(e,t){if(!t)return null;for(const r of e)if(typeof t=="string"){if(Ro(t,r))return r}else if(ArrayBuffer.isView(t)){if(Hr(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&Hr(t,0,r))return r;return null}function Ro(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>e.startsWith(s))}function Hr(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>Eo(e,t,r,i))}function Eo(e,t,r,s){if(s instanceof ArrayBuffer)return On(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":const i=Ht(e,t,s.length);return s===i;default:return!1}}function qs(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Ht(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ht(e,0,t):""}function Ht(e,t,r){if(e.byteLength<t+r)return"";const s=new DataView(e);let i="";for(let n=0;n<r;n++)i+=String.fromCharCode(s.getUint8(t+n));return i}const So=256*1024;function*bo(e,t){const r=t?.chunkSize||So;let s=0;const i=new TextEncoder;for(;s<e.length;){const n=Math.min(e.length-s,r),o=e.slice(s,s+n);s+=n,yield i.encode(o)}}const Co=256*1024;function*Mo(e,t={}){const{chunkSize:r=Co}=t;let s=0;for(;s<e.byteLength;){const i=Math.min(e.byteLength-s,r),n=new ArrayBuffer(i),o=new Uint8Array(e,s,i);new Uint8Array(n).set(o),s+=i,yield n}}const Io=1024*1024;async function*No(e,t){const r=t?.chunkSize||Io;let s=0;for(;s<e.size;){const i=s+r,n=await e.slice(s,i).arrayBuffer();s=i,yield n}}function Xr(e,t){return Ds?Oo(e,t):yo(e)}async function*Oo(e,t){const r=e.getReader();let s;try{for(;;){const i=s||r.read();t?._streamReadAhead&&(s=r.read());const{done:n,value:o}=await i;if(n)return;yield ks(o)}}catch{r.releaseLock()}}async function*yo(e,t){for await(const r of e)yield ks(r)}function Po(e,t){if(typeof e=="string")return bo(e,t);if(e instanceof ArrayBuffer)return Mo(e,t);if(ce(e))return No(e,t);if(Xs(e))return Xr(e,t);if(ae(e))return Xr(e.body,t);throw new Error("makeIterator")}const Qs="Cannot convert supplied data type";function Fo(e,t,r){if(t.text&&typeof e=="string")return e;if(kn(e)&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const i=e.byteLength||e.length;return(e.byteOffset!==0||i!==s.byteLength)&&(s=s.slice(e.byteOffset,e.byteOffset+i)),s}throw new Error(Qs)}async function mo(e,t,r){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||s)return Fo(e,t);if(ce(e)&&(e=await js(e)),ae(e)){const i=e;return await Zn(i),t.binary?await i.arrayBuffer():await i.text()}if(Xs(e)&&(e=Po(e,r)),vn(e)||Wn(e))return Fn(e);throw new Error(Qs)}function Js(e,t){const r=Ls(),s=e||r;return typeof s.fetch=="function"?s.fetch:We(s.fetch)?i=>xr(i,s.fetch):t?.fetch?t?.fetch:xr}function Do(e,t,r){if(r)return r;const s={fetch:Js(t,e),...e};if(s.url){const i=Jt(s.url);s.baseUrl=i,s.queryString=Ln(s.url),s.filename=Hs(i),s.baseUrl=xn(i)}return Array.isArray(s.loaders)||(s.loaders=null),s}function Bo(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...s]:s}return r&&r.length?r:void 0}async function qe(e,t,r,s){t&&!Array.isArray(t)&&!er(t)&&(s=void 0,r=t,t=void 0),e=await e,r=r||{};const i=ft(e),o=Bo(t,s),a=await _o(e,o,r);return a?(r=no(r,a,o,i),s=Do({url:i,_parse:qe,loaders:o},r,s||null),await wo(a,e,r,s)):null}async function wo(e,t,r,s){if(Cn(e),r=hn(e.options,r),ae(t)){const n=t,{ok:o,redirected:a,status:c,statusText:l,type:f,url:h}=n,_=Object.fromEntries(n.headers.entries());s.response={headers:_,ok:o,redirected:a,status:c,statusText:l,type:f,url:h}}t=await mo(t,e,r);const i=e;if(i.parseTextSync&&typeof t=="string")return i.parseTextSync(t,r,s);if(Mn(e,r))return await In(e,t,r,s,qe);if(i.parseText&&typeof t=="string")return await i.parseText(t,r,s);if(i.parse)return await i.parse(t,r,s);throw ee(!i.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function Kh(e,t,r,s){let i,n;!Array.isArray(t)&&!er(t)?(i=[],n=t):(i=t,n=r);const o=Js(n);let a=e;return typeof e=="string"&&(a=await o(e)),ce(e)&&(a=await o(e)),Array.isArray(i)?await qe(a,i,n):await qe(a,i,n)}const rr=new ve({id:"deck"});let Xt={};function Zh(e){Xt=e}function qh(e,t,r,s){rr.level>0&&Xt[e]&&Xt[e].call(null,t,r,s)}function sr(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const St={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function xo(e){const t={};for(const[r,s]of Object.entries(e))t[r]=Uo(s);return t}function Uo(e){let t=Vr(e);if(t!=="object")return{value:e,...St[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...St[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=Vr(e.value),{...e,...St[t],type:t}):{type:"object",value:null};throw new Error("props")}function Vr(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const vo=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Wo=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,ko={vertex:vo,fragment:Wo},jr=/void\s+main\s*\([^)]*\)\s*\{\n?/,zr=/}\n?[^{}]*$/,bt=[],Ye="__LUMA_INJECT_DECLARATIONS__";function Ho(e){const t={vertex:{},fragment:{}};for(const r in e){let s=e[r];const i=Xo(r);typeof s=="string"&&(s={order:0,injection:s}),t[i][r]=s}return t}function Xo(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Qe(e,t,r,s=!1){const i=t==="vertex";for(const n in r){const o=r[n];o.sort((c,l)=>c.order-l.order),bt.length=o.length;for(let c=0,l=o.length;c<l;++c)bt[c]=o[c].injection;const a=`${bt.join(`
`)}
`;switch(n){case"vs:#decl":i&&(e=e.replace(Ye,a));break;case"vs:#main-start":i&&(e=e.replace(jr,c=>c+a));break;case"vs:#main-end":i&&(e=e.replace(zr,c=>a+c));break;case"fs:#decl":i||(e=e.replace(Ye,a));break;case"fs:#main-start":i||(e=e.replace(jr,c=>c+a));break;case"fs:#main-end":i||(e=e.replace(zr,c=>a+c));break;default:e=e.replace(n,c=>c+a)}}return e=e.replace(Ye,""),s&&(e=e.replace(/\}\s*$/,n=>n+ko[t])),e}function Je(e){e.map(t=>Vo(t))}function Vo(e){if(e.instance)return;Je(e.dependencies||[]);const{propTypes:t={},deprecations:r=[],inject:s={}}=e,i={normalizedInjections:Ho(s),parsedDeprecations:jo(r)};t&&(i.propValidators=xo(t)),e.instance=i;let n={};t&&(n=Object.entries(t).reduce((o,[a,c])=>{const l=c?.value;return l&&(o[a]=l),o},{})),e.defaultUniforms={...e.defaultUniforms,...n}}function Gs(e,t,r){e.deprecations?.forEach(s=>{s.regex?.test(t)&&(s.deprecated?r.deprecated(s.old,s.new)():r.removed(s.old,s.new)())})}function jo(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function ei(e){Je(e);const t={},r={};ti({modules:e,level:0,moduleMap:t,moduleDepth:r});const s=Object.keys(r).sort((i,n)=>r[n]-r[i]).map(i=>t[i]);return Je(s),s}function ti(e){const{modules:t,level:r,moduleMap:s,moduleDepth:i}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const n of t)s[n.name]=n,(i[n.name]===void 0||i[n.name]<r)&&(i[n.name]=r);for(const n of t)n.dependencies&&ti({modules:n.dependencies,level:r+1,moduleMap:s,moduleDepth:i})}function zo(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function $o(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=$r(e,Lo),e;case"fragment":return e=$r(e,Yo),e;default:throw new Error(t)}}const ri=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Lo=[...ri,[Vt("attribute"),"in $1"],[Vt("varying"),"out $1"]],Yo=[...ri,[Vt("varying"),"in $1"]];function $r(e,t){for(const[r,s]of t)e=e.replace(r,s);return e}function Vt(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function si(e,t){let r="";for(const s in e){const i=e[s];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),t[s]){const n=t[s];n.sort((o,a)=>o.order-a.order);for(const o of n)r+=`  ${o.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function ii(e){const t={vertex:{},fragment:{}};for(const r of e){let s,i;typeof r!="string"?(s=r,i=s.hook):(s={},i=r),i=i.trim();const[n,o]=i.split(":"),a=i.replace(/\(.+/,""),c=Object.assign(s,{signature:o});switch(n){case"vs":t.vertex[a]=c;break;case"fs":t.fragment[a]=c;break;default:throw new Error(n)}}return t}function Ko(e,t){return{name:Zo(e,t),language:"glsl",version:qo(e)}}function Zo(e,t="unnamed"){const s=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return s?s[1]:t}function qo(e){let t=100;const r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const s=parseInt(r[1],10);Number.isFinite(s)&&(t=s)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const ni=`

${Ye}
`,Qo=`precision highp float;
`;function Jo(e){const t=ei(e.modules||[]);return{source:ea(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:oi(t)}}function Go(e){const{vs:t,fs:r}=e,s=ei(e.modules||[]);return{vs:Lr(e.platformInfo,{...e,source:t,stage:"vertex",modules:s}),fs:Lr(e.platformInfo,{...e,source:r,stage:"fragment",modules:s}),getUniforms:oi(s)}}function ea(e,t){const{source:r,stage:s,modules:i,hookFunctions:n=[],inject:o={},log:a}=t;sr(typeof r=="string","shader source must be a string");const c=r;let l="";const f=ii(n),h={},_={},d={};for(const g in o){const T=typeof o[g]=="string"?{injection:o[g],order:0}:o[g],p=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(p){const A=p[2],R=p[3];A?R==="decl"?_[g]=[T]:d[g]=[T]:h[g]=[T]}else d[g]=[T]}const u=i;for(const g of u){a&&Gs(g,c,a);const T=ai(g,"wgsl");l+=T;const p=g.injections?.[s]||{};for(const A in p){const R=/^(v|f)s:#([\w-]+)$/.exec(A);if(R){const b=R[2]==="decl"?_:d;b[A]=b[A]||[],b[A].push(p[A])}else h[A]=h[A]||[],h[A].push(p[A])}}return l+=ni,l=Qe(l,s,_),l+=si(f[s],h),l+=c,l=Qe(l,s,d),l}function Lr(e,t){const{id:r,source:s,stage:i,language:n="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:f=!0,log:h}=t;sr(typeof s=="string","shader source must be a string");const _=n==="glsl"?Ko(s).version:-1,d=e.shaderLanguageVersion,u=_===100?"#version 100":"#version 300 es",T=s.split(`
`).slice(1).join(`
`),p={};o.forEach(I=>{Object.assign(p,I.defines)}),Object.assign(p,a);let A="";switch(n){case"wgsl":break;case"glsl":A=f?`${u}

// ----- PROLOGUE -------------------------
${ta({id:r,source:s,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${zo(e)}
${i==="fragment"?Qo:""}

// ----- APPLICATION DEFINES -------------------------

${ra(p)}

`:`${u}
`;break}const R=ii(c),E={},b={},C={};for(const I in l){const D=typeof l[I]=="string"?{injection:l[I],order:0}:l[I],P=/^(v|f)s:(#)?([\w-]+)$/.exec(I);if(P){const O=P[2],W=P[3];O?W==="decl"?b[I]=[D]:C[I]=[D]:E[I]=[D]}else C[I]=[D]}for(const I of o){h&&Gs(I,T,h);const D=ai(I,i);A+=D;const P=I.instance?.normalizedInjections[i]||{};for(const O in P){const W=/^(v|f)s:#([\w-]+)$/.exec(O);if(W){const H=W[2]==="decl"?b:C;H[O]=H[O]||[],H[O].push(P[O])}else E[O]=E[O]||[],E[O].push(P[O])}}return A+="// ----- MAIN SHADER SOURCE -------------------------",A+=ni,A=Qe(A,i,b),A+=si(R[i],E),A+=T,A=Qe(A,i,C),n==="glsl"&&_!==d&&(A=$o(A,i)),A.trim()}function oi(e){return function(r){const s={};for(const i of e){const n=i.getUniforms?.(r,s);Object.assign(s,n)}return s}}function ta(e){const{id:t,source:r,stage:s}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${s}`:""}function ra(e={}){let t="";for(const r in e){const s=e[r];(s||Number.isFinite(s))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}function ai(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:sr(!1)}if(!e.name)throw new Error("Shader module must have a name");const s=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${e.name} ---------------

`;return t!=="wgsl"&&(i+=`#define MODULE_${s}
`),i+=`${r}
`,i}const sa=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,ia=/^\s*\#\s*endif\s*$/;function na(e,t){const r=e.split(`
`),s=[];let i=!0,n=null;for(const o of r){const a=o.match(sa),c=o.match(ia);a?(n=a[1],i=!!t?.defines?.[n]):c?i=!0:i&&s.push(o)}return s.join(`
`)}class Pe{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Pe.defaultShaderAssembler=Pe.defaultShaderAssembler||new Pe,Pe.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const r=this._getModuleList(t.modules),s=this._hookFunctions,{source:i,getUniforms:n}=Jo({...t,source:t.source,modules:r,hookFunctions:s});return{source:t.platformInfo.shaderLanguage==="wgsl"?na(i):i,getUniforms:n,modules:r}}assembleGLSLShaderPair(t){const r=this._getModuleList(t.modules),s=this._hookFunctions;return{...Go({...t,vs:t.vs,fs:t.fs,modules:r,hookFunctions:s}),modules:r}}_getModuleList(t=[]){const r=new Array(this._defaultModules.length+t.length),s={};let i=0;for(let n=0,o=this._defaultModules.length;n<o;++n){const a=this._defaultModules[n],c=a.name;r[i++]=a,s[c]=!0}for(let n=0,o=t.length;n<o;++n){const a=t[n],c=a.name;s[c]||(r[i++]=a,s[c]=!0)}return r.length=i,Je(r),r}}class oa{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new mn({id:t})),this.stats.get(t)}}const aa=new oa,S=new ve({id:"luma.gl"}),Ct={};function ht(e="id"){Ct[e]=Ct[e]||1;const t=Ct[e]++;return`${e}-${t}`}class y{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,s){if(!t)throw new Error("no device");this._device=t,this.props=ca(r,s);const i=this.props.id!=="undefined"?this.props.id:ht(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){const s=this._device.statsManager.getStats("Resource Counts");s.get("GPU Memory").addCount(t),s.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}}function ca(e,t){const r={...t};for(const s in e)e[s]!==void 0&&(r[s]=e[s]);return r}class $ extends y{static defaultProps={...y.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){const s={...r};(r.usage||0)&$.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data,super(t,s,$.defaultProps),this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,r,s){const i=ArrayBuffer.isView(t)?t.buffer:t,n=Math.min(t?t.byteLength:s,$.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(n):r===0&&s===i.byteLength?this.debugData=i.slice(0,n):this.debugData=i.slice(r,r+n)}}function ci(e){const t=Yr[e],r=la(t),s=e.includes("norm"),i=!s&&!e.startsWith("float"),n=e.startsWith("s");return{dataType:Yr[e],byteLength:r,integer:i,signed:n,normalized:s}}function la(e){return fa[e]}const Yr={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},fa={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},k="texture-compression-bc",N="texture-compression-astc",q="texture-compression-etc2",ha="texture-compression-etc1-webgl",ke="texture-compression-pvrtc-webgl",Mt="texture-compression-atc-webgl",He="float32-renderable-webgl",It="float16-renderable-webgl",_a="rgb9e5ufloat-renderable-webgl",Nt="snorm8-renderable-webgl",Ne="norm16-renderable-webgl",Ot="snorm16-renderable-webgl",Xe="float32-filterable",Kr="float16-filterable-webgl";function li(e){const t=da[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const da={r8unorm:{},r8snorm:{render:Nt},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Nt},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:It,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ne},"r16snorm-webgl":{f:Ot},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Nt},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:It,filter:Kr},"rg16unorm-webgl":{render:Ne},"rg16snorm-webgl":{render:Ot},r32uint:{},r32sint:{},r32float:{render:He,filter:Xe},rgb9e5ufloat:{channels:"rgb",packed:!0,render:_a},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:He},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ne},"rgb16snorm-webgl":{f:Ne},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Xe},rgba16uint:{},rgba16sint:{},rgba16float:{render:It,filter:Kr},"rgba16unorm-webgl":{render:Ne},"rgba16snorm-webgl":{render:Ot},"rgb32float-webgl":{render:He,filter:Xe},rgba32uint:{},rgba32sint:{},rgba32float:{render:He,filter:Xe},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:k},"bc1-rgb-unorm-srgb-webgl":{f:k},"bc1-rgba-unorm":{f:k},"bc1-rgba-unorm-srgb":{f:k},"bc2-rgba-unorm":{f:k},"bc2-rgba-unorm-srgb":{f:k},"bc3-rgba-unorm":{f:k},"bc3-rgba-unorm-srgb":{f:k},"bc4-r-unorm":{f:k},"bc4-r-snorm":{f:k},"bc5-rg-unorm":{f:k},"bc5-rg-snorm":{f:k},"bc6h-rgb-ufloat":{f:k},"bc6h-rgb-float":{f:k},"bc7-rgba-unorm":{f:k},"bc7-rgba-unorm-srgb":{f:k},"etc2-rgb8unorm":{f:q},"etc2-rgb8unorm-srgb":{f:q},"etc2-rgb8a1unorm":{f:q},"etc2-rgb8a1unorm-srgb":{f:q},"etc2-rgba8unorm":{f:q},"etc2-rgba8unorm-srgb":{f:q},"eac-r11unorm":{f:q},"eac-r11snorm":{f:q},"eac-rg11unorm":{f:q},"eac-rg11snorm":{f:q},"astc-4x4-unorm":{f:N},"astc-4x4-unorm-srgb":{f:N},"astc-5x4-unorm":{f:N},"astc-5x4-unorm-srgb":{f:N},"astc-5x5-unorm":{f:N},"astc-5x5-unorm-srgb":{f:N},"astc-6x5-unorm":{f:N},"astc-6x5-unorm-srgb":{f:N},"astc-6x6-unorm":{f:N},"astc-6x6-unorm-srgb":{f:N},"astc-8x5-unorm":{f:N},"astc-8x5-unorm-srgb":{f:N},"astc-8x6-unorm":{f:N},"astc-8x6-unorm-srgb":{f:N},"astc-8x8-unorm":{f:N},"astc-8x8-unorm-srgb":{f:N},"astc-10x5-unorm":{f:N},"astc-10x5-unorm-srgb":{f:N},"astc-10x6-unorm":{f:N},"astc-10x6-unorm-srgb":{f:N},"astc-10x8-unorm":{f:N},"astc-10x8-unorm-srgb":{f:N},"astc-10x10-unorm":{f:N},"astc-10x10-unorm-srgb":{f:N},"astc-12x10-unorm":{f:N},"astc-12x10-unorm-srgb":{f:N},"astc-12x12-unorm":{f:N},"astc-12x12-unorm-srgb":{f:N},"pvrtc-rgb4unorm-webgl":{f:ke},"pvrtc-rgba4unorm-webgl":{f:ke},"pvrtc-rbg2unorm-webgl":{f:ke},"pvrtc-rgba2unorm-webgl":{f:ke},"etc1-rbg-unorm-webgl":{f:ha},"atc-rgb-unorm-webgl":{f:Mt},"atc-rgba-unorm-webgl":{f:Mt},"atc-rgbai-unorm-webgl":{f:Mt}},ua=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],ga=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function fi(e){return ua.some(t=>e.startsWith(t))}function ir(e){let t=Ta(e);if(fi(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const s=Aa(e);s&&(t.blockWidth=s.blockWidth,t.blockHeight=s.blockHeight)}const r=ga.exec(e);if(r){const[,s,i,n,o,a]=r,c=`${n}${i}`,l=ci(c),f=l.byteLength*8,h=s.length,_=[f,h>=2?f:0,h>=3?f:0,h>=4?f:0];t={format:e,attachment:t.attachment,dataType:l.dataType,components:h,channels:s,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:_,bytesPerPixel:l.byteLength*s.length,packed:t.packed,srgb:t.srgb},a==="-webgl"&&(t.webgl=!0),o==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function Ta(e){const t=li(e),r=t.bytesPerPixel||1,s=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:r,bitsPerChannel:s,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function Aa(e){const r=/.*-(\d+)x(\d+)-.*/.exec(e);if(r){const[,s,i]=r;return{blockWidth:Number(s),blockHeight:Number(i)}}return null}function pa(e){const t=li(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=ir(e),i=e.startsWith("depth")||e.startsWith("stencil"),n=s?.signed,o=s?.integer,a=s?.webgl;return r.render&&=!n,r.filter&&=!i&&!n&&!o&&!a,r}class Ra{}class Ea{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class Ge{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:t=>S.error(t.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:S.get("debug")||void 0,debugShaders:S.get("debug-shaders")||void 0,debugFramebuffers:!!S.get("debug-framebuffers"),debugWebGL:!!S.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(t){this.props={...Ge.defaultProps,...t},this.id=this.props.id||ht(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=aa;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(t){const r=pa(t),s=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=s(r.create),n={format:t,create:i,render:i&&s(r.render),filter:i&&s(r.filter),blend:i&&s(r.blend),store:i&&s(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(n)}isTextureFormatSupported(t,r){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return fi(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const r={...t};return(t.usage||0)&$.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":S.warn("indices buffer content must be of integer type")()),r}}class nr{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...nr.defaultProps,...t},t=this.props,!Ce()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=ba(t.canvas):this.canvas=t.canvas;else{const r=Ca(t),s=Sa(t?.container||null);s.insertBefore(r,s.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const s of r)s.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){const s=this.cssToDeviceRatio(),[i,n]=this.getDrawingBufferSize();return Ma(t,s,i,n,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let s="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!s||!i)&&(S.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,s=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const n=this._canvasSizeInfo;if(n.clientWidth!==s||n.clientHeight!==i||n.devicePixelRatio!==t){let o=t;const a=Math.floor(s*o),c=Math.floor(i*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=c,this.device.gl){const[f,h]=this.getDrawingBufferSize();(f!==a||h!==c)&&(o=Math.min(f/s,h/i),this.htmlCanvas.width=Math.floor(s*o),this.htmlCanvas.height=Math.floor(i*o),S.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=s,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){const t=this.device.gl;return t?[t.drawingBufferWidth,t.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}}function Sa(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function ba(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function Ca(e){const{width:t,height:r}=e,s=document.createElement("canvas");return s.id=ht("lumagl-auto-created-canvas"),s.width=t||1,s.height=r||1,s.style.width=Number.isFinite(t)?`${t}px`:"100%",s.style.height=Number.isFinite(r)?`${r}px`:"100%",s}function Ma(e,t,r,s,i){const n=e,o=Zr(n[0],t,r);let a=qr(n[1],t,s,i),c=Zr(n[0]+1,t,r);const l=c===r-1?c:c-1;c=qr(n[1]+1,t,s,i);let f;return i?(c=c===0?c:c+1,f=a,a=c):f=c===s-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(f-a+1,1)}}function Zr(e,t,r){return Math.min(Math.round(e*t),r-1)}function qr(e,t,r,s){return s?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}class m extends y{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...y.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(t,r){if(r=m.normalizeProps(t,r),super(t,r,m.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=m.getTextureDataSize(this.props.data);this.width=s?.width||1,this.height=s?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?m.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return m.getTextureDataSize(t[0]);if(m.isExternalImage(t))return m.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(t,r){const s={...r},i=t?.props?._resourceDefaults?.texture||{};Object.assign(s,i);const{width:n,height:o}=s;return typeof n=="number"&&(s.width=Math.max(1,Math.ceil(n))),typeof o=="number"&&(s.height=Math.max(1,Math.ceil(o))),s}}class or extends y{static defaultProps={...y.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,or.defaultProps)}}function Ia(e,t,r){let s="";const i=t.split(/\r?\n/),n=e.slice().sort((o,a)=>o.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(s+=hi(i[a-1],a,r);n.length>o&&n[o].lineNum===a;){const c=n[o++];s+=Qr(c,i,c.lineNum,{...r,inlineSource:!1})}return s;case"issues":case"no":for(const a of e)s+=Qr(a,i,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return s}}function Qr(e,t,r,s){if(s?.inlineSource){const n=Na(t,r),o=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${n}${o}${e.type.toUpperCase()}: ${e.message}

`}const i=e.type==="error"?"red":"#8B4000";return s?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Na(e,t,r){let s="";for(let i=t-2;i<=t;i++){const n=e[i-1];n!==void 0&&(s+=hi(n,t,r))}return s}function hi(e,t,r){const s=r?.html?ya(e):e;return`${Oa(String(t),4)}: ${s}${r?.html?"<br/>":`
`}`}function Oa(e,t){let r="";for(let s=e.length;s<t;++s)r+=" ";return r+e}function ya(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class ar extends y{static defaultProps={...y.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"},super(t,{id:Pa(r),...r},ar.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;const r=_i(this.source),s=`${this.stage} ${r}`;let i=Ia(t,this.source,{showSourceCode:"all",html:!0});const n=this.getTranslatedSource();n&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${n}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}}function Pa(e){return _i(e.source)||e.id||ht(`unnamed ${e.stage}-shader`)}function _i(e,t="unnamed"){const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return s?s[1]:t}class et extends y{static defaultProps={...y.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){r=et.normalizeProps(t,r),super(t,r,et.defaultProps)}static normalizeProps(t,r){const s=t?.props?._resourceDefaults?.sampler||{};return{...r,...s}}}class _t extends y{static defaultProps={...y.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,r={}){super(t,r,_t.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const r=this.colorAttachments.map(i=>i.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:s})}resize(t){let r=!t;if(t){const[s,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||s!==this.width,this.width=s,this.height=i}r&&(S.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,s)=>{if(typeof r=="string"){const i=this.createColorTexture(r,s);return this.attachResource(i),i.view}return r instanceof m?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof m?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:m.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:m.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const i=this.colorAttachments[s].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}}class cr extends y{static defaultProps={...y.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,cr.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}}class te extends y{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...y.defaultProps,framebuffer:null,parameters:void 0,clearColor:te.defaultClearColor,clearColors:void 0,clearDepth:te.defaultClearDepth,clearStencil:te.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){r=te.normalizeProps(t,r),super(t,r,te.defaultProps)}static normalizeProps(t,r){return{...t.props._resourceDefaults?.renderPass,...r}}}class lr extends y{static defaultProps={...y.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,lr.defaultProps)}}class fr extends y{static defaultProps={...y.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,fr.defaultProps)}}function Fa(e){const[t,r]=Da[e],s=t==="i32"||t==="u32",i=t!=="u32",n=Ba[t]*r,o=ma(t,r);return{dataType:t,components:r,defaultVertexFormat:o,byteLength:n,integer:s,signed:i}}function ma(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}const Da={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Ba={f32:4,f16:2,i32:4,u32:4};function di(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[r,s]=e.split("x"),i=r,n=s?parseInt(s):1,o=ci(i),a={type:i,components:n,byteLength:o.byteLength*n,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function wa(e,t){const r={};for(const s of e.attributes){const i=Ua(e,t,s.name);i&&(r[s.name]=i)}return r}function xa(e,t,r=16){const s=wa(e,t),i=new Array(r).fill(null);for(const n of Object.values(s))i[n.location]=n;return i}function Ua(e,t,r){const s=va(e,r),i=Wa(t,r);if(!s)return null;const n=Fa(s.type),o=i?.vertexFormat||n.defaultVertexFormat,a=di(o);return{attributeName:i?.attributeName||s.name,bufferName:i?.bufferName||s.name,location:s.location,shaderType:s.type,shaderDataType:n.dataType,shaderComponents:n.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:n.integer,stepMode:i?.stepMode||s.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function va(e,t){const r=e.attributes.find(s=>s.name===t);return r||S.warn(`shader layout attribute "${t}" not present in shader`),r||null}function Wa(e,t){ka(e);let r=Ha(e,t);return r||(r=Xa(e,t),r)?r:(S.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function ka(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&S.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Ha(e,t){for(const r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Xa(e,t){for(const r of e){let s=r.byteStride;if(typeof r.byteStride!="number")for(const n of r.attributes||[]){const o=di(n.format);s+=o.byteLength}const i=r.attributes?.find(n=>n.attribute===t);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:s}}return null}class hr extends y{static defaultProps={...y.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,hr.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:i}=r.renderPipeline||{};if(!s||!i)throw new Error("VertexArray");this.attributeInfos=xa(s,i,this.maxVertexAttributes)}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}}class _r extends y{static defaultProps={...y.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,_r.defaultProps)}}class dr extends y{static defaultProps={...y.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,dr.defaultProps)}}let Ve;function Va(e){return(!Ve||Ve.byteLength<e)&&(Ve=new ArrayBuffer(e)),Ve}function ja(e,t){const r=Va(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}const za={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...za}};const L=globalThis.mathgl.config;function $a(e,{precision:t=L.precision}={}){return e=Ya(e),`${parseFloat(e.toPrecision(t))}`}function pe(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function tt(e,t,r){return Za(e,s=>Math.max(t,Math.min(r,s)))}function La(e,t,r){return pe(e)?e.map((s,i)=>La(s,t[i],r)):r*t+(1-r)*e}function rt(e,t,r){const s=L.EPSILON;try{if(e===t)return!0;if(pe(e)&&pe(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!rt(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=L.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{L.EPSILON=s}}function Ya(e){return Math.round(e/L.EPSILON)*L.EPSILON}function Ka(e){return e.clone?e.clone():new Array(e.length)}function Za(e,t,r){if(pe(e)){const s=e;r=r||Ka(s);for(let i=0;i<r.length&&i<s.length;++i){const n=typeof e=="number"?e:e[i];r[i]=t(n,i,r)}return r}return t(e)}class ui extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+r];return this.check()}toArray(t=[],r=0){for(let s=0;s<this.ELEMENTS;++s)t[r+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:pe(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(L)}formatString(t){let r="";for(let s=0;s<this.ELEMENTS;++s)r+=(s>0?", ":"")+$a(this[s],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!rt(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,s){if(s===void 0)return this.lerp(this,t,r);for(let i=0;i<this.ELEMENTS;++i){const n=t[i],o=typeof r=="number"?r:r[i];this[i]=n+s*(o-n)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),r[s]);return this.check()}add(...t){for(const r of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=r[s];return this.check()}subtract(...t){for(const r of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=r[s];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(L.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),r);return this.check()}get elements(){return this}}function qa(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function j(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function yt(e,t,r=""){if(L.debug&&!qa(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function Jr(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Qa extends ui{get x(){return this[0]}set x(t){this[0]=j(t)}get y(){return this[1]}set y(t){this[1]=j(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let s=0;s<this.ELEMENTS;++s){const i=this[s]-t[s];r+=i*i}return j(r)}dot(t){let r=0;for(let s=0;s<this.ELEMENTS;++s)r+=this[s]*t[s];return j(r)}normalize(){const t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(const r of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=r[s];return this.check()}divide(...t){for(const r of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=r[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Jr(t>=0&&t<this.ELEMENTS,"index is out of range"),j(this[t])}setComponent(t,r){return Jr(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}}const Ke=1e-6;let Re=typeof Float32Array<"u"?Float32Array:Array;function Ja(){const e=new Re(2);return Re!=Float32Array&&(e[0]=0,e[1]=0),e}function Gr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Ga(e,t){return e[0]=-t[0],e[1]=-t[1],e}function gi(e,t,r,s){const i=t[0],n=t[1];return e[0]=i+s*(r[0]-i),e[1]=n+s*(r[1]-n),e}function ec(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[4]*i+r[12],e[1]=r[1]*s+r[5]*i+r[13],e}(function(){const e=Ja();return function(t,r,s,i,n,o){let a,c;for(r||(r=2),s||(s=0),i?c=Math.min(i*r+s,t.length):c=t.length,a=s;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],n(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function tc(e,t,r){const s=t[0],i=t[1],n=r[3]*s+r[7]*i||1;return e[0]=(r[0]*s+r[4]*i)/n,e[1]=(r[1]*s+r[5]*i)/n,e}function Ti(e,t,r){const s=t[0],i=t[1],n=t[2],o=r[3]*s+r[7]*i+r[11]*n||1;return e[0]=(r[0]*s+r[4]*i+r[8]*n)/o,e[1]=(r[1]*s+r[5]*i+r[9]*n)/o,e[2]=(r[2]*s+r[6]*i+r[10]*n)/o,e}function rc(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[2]*i,e[1]=r[1]*s+r[3]*i,e[2]=t[2],e}function sc(){const e=new Re(3);return Re!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ic(e){const t=e[0],r=e[1],s=e[2];return Math.sqrt(t*t+r*r+s*s)}function nc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function oc(e){const t=e[0],r=e[1],s=e[2];return t*t+r*r+s*s}function ac(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function cc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lc(e,t,r){const s=t[0],i=t[1],n=t[2],o=r[0],a=r[1],c=r[2];return e[0]=i*c-n*a,e[1]=n*o-s*c,e[2]=s*a-i*o,e}function Qh(e,t,r,s){const i=t[0],n=t[1],o=t[2];return e[0]=i+s*(r[0]-i),e[1]=n+s*(r[1]-n),e[2]=o+s*(r[2]-o),e}function Ai(e,t,r){const s=t[0],i=t[1],n=t[2];let o=r[3]*s+r[7]*i+r[11]*n+r[15];return o=o||1,e[0]=(r[0]*s+r[4]*i+r[8]*n+r[12])/o,e[1]=(r[1]*s+r[5]*i+r[9]*n+r[13])/o,e[2]=(r[2]*s+r[6]*i+r[10]*n+r[14])/o,e}function fc(e,t,r){const s=t[0],i=t[1],n=t[2];return e[0]=s*r[0]+i*r[3]+n*r[6],e[1]=s*r[1]+i*r[4]+n*r[7],e[2]=s*r[2]+i*r[5]+n*r[8],e}function hc(e,t,r){const s=r[0],i=r[1],n=r[2],o=r[3],a=t[0],c=t[1],l=t[2];let f=i*l-n*c,h=n*a-s*l,_=s*c-i*a,d=i*_-n*h,u=n*f-s*_,g=s*h-i*f;const T=o*2;return f*=T,h*=T,_*=T,d*=2,u*=2,g*=2,e[0]=a+f+d,e[1]=c+h+u,e[2]=l+_+g,e}function _c(e,t,r,s){const i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[0],n[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),n[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function dc(e,t,r,s){const i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),n[1]=i[1],n[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function uc(e,t,r,s){const i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),n[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),n[2]=i[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function gc(e,t){const r=e[0],s=e[1],i=e[2],n=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+s*s+i*i)*(n*n+o*o+a*a)),l=c&&cc(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const Jh=nc,Gh=ic,e_=oc;(function(){const e=sc();return function(t,r,s,i,n,o){let a,c;for(r||(r=3),s||(s=0),i?c=Math.min(i*r+s,t.length):c=t.length,a=s;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],n(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const Pt=[0,0,0];let je;class Ee extends Qa{static get ZERO(){return je||(je=new Ee(0,0,0),Object.freeze(je)),je}constructor(t=0,r=0,s=0){super(-0,-0,-0),arguments.length===1&&pe(t)?this.copy(t):(L.debug&&(j(t),j(r),j(s)),this[0]=t,this[1]=r,this[2]=s)}set(t,r,s){return this[0]=t,this[1]=r,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return L.debug&&(j(t.x),j(t.y),j(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=j(t)}angle(t){return gc(this,t)}cross(t){return lc(this,this,t),this.check()}rotateX({radians:t,origin:r=Pt}){return _c(this,this,r,t),this.check()}rotateY({radians:t,origin:r=Pt}){return dc(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=Pt}){return uc(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Ai(this,this,t),this.check()}transformAsVector(t){return Ti(this,this,t),this.check()}transformByMatrix3(t){return fc(this,this,t),this.check()}transformByMatrix2(t){return rc(this,this,t),this.check()}transformByQuaternion(t){return hc(this,this,t),this.check()}}class Tc extends ui{toString(){let t="[";if(L.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let s=0;s<this.RANK;++s)t+=` ${this[s*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,s){return this[r*this.RANK+t]=j(s),this}getColumn(t,r=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[s+i];return r}setColumn(t,r){const s=t*this.RANK;for(let i=0;i<this.RANK;++i)this[s+i]=r[i];return this}}function Ac(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pc(e,t){if(e===t){const r=t[1],s=t[2],i=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=n,e[11]=t[14],e[12]=i,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function jt(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],f=t[8],h=t[9],_=t[10],d=t[11],u=t[12],g=t[13],T=t[14],p=t[15],A=r*a-s*o,R=r*c-i*o,E=r*l-n*o,b=s*c-i*a,C=s*l-n*a,I=i*l-n*c,D=f*g-h*u,P=f*T-_*u,O=f*p-d*u,W=h*T-_*g,z=h*p-d*g,H=_*p-d*T;let F=A*H-R*z+E*W+b*O-C*P+I*D;return F?(F=1/F,e[0]=(a*H-c*z+l*W)*F,e[1]=(i*z-s*H-n*W)*F,e[2]=(g*I-T*C+p*b)*F,e[3]=(_*C-h*I-d*b)*F,e[4]=(c*O-o*H-l*P)*F,e[5]=(r*H-i*O+n*P)*F,e[6]=(T*E-u*I-p*R)*F,e[7]=(f*I-_*E+d*R)*F,e[8]=(o*z-a*O+l*D)*F,e[9]=(s*O-r*z-n*D)*F,e[10]=(u*C-g*E+p*A)*F,e[11]=(h*E-f*C-d*A)*F,e[12]=(a*P-o*W-c*D)*F,e[13]=(r*W-s*P+i*D)*F,e[14]=(g*R-u*b-T*A)*F,e[15]=(f*b-h*R+_*A)*F,e):null}function Rc(e){const t=e[0],r=e[1],s=e[2],i=e[3],n=e[4],o=e[5],a=e[6],c=e[7],l=e[8],f=e[9],h=e[10],_=e[11],d=e[12],u=e[13],g=e[14],T=e[15],p=t*o-r*n,A=t*a-s*n,R=r*a-s*o,E=l*u-f*d,b=l*g-h*d,C=f*g-h*u,I=t*C-r*b+s*E,D=n*C-o*b+a*E,P=l*R-f*A+h*p,O=d*R-u*A+g*p;return c*I-i*D+T*P-_*O}function se(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=t[6],f=t[7],h=t[8],_=t[9],d=t[10],u=t[11],g=t[12],T=t[13],p=t[14],A=t[15];let R=r[0],E=r[1],b=r[2],C=r[3];return e[0]=R*s+E*a+b*h+C*g,e[1]=R*i+E*c+b*_+C*T,e[2]=R*n+E*l+b*d+C*p,e[3]=R*o+E*f+b*u+C*A,R=r[4],E=r[5],b=r[6],C=r[7],e[4]=R*s+E*a+b*h+C*g,e[5]=R*i+E*c+b*_+C*T,e[6]=R*n+E*l+b*d+C*p,e[7]=R*o+E*f+b*u+C*A,R=r[8],E=r[9],b=r[10],C=r[11],e[8]=R*s+E*a+b*h+C*g,e[9]=R*i+E*c+b*_+C*T,e[10]=R*n+E*l+b*d+C*p,e[11]=R*o+E*f+b*u+C*A,R=r[12],E=r[13],b=r[14],C=r[15],e[12]=R*s+E*a+b*h+C*g,e[13]=R*i+E*c+b*_+C*T,e[14]=R*n+E*l+b*d+C*p,e[15]=R*o+E*f+b*u+C*A,e}function st(e,t,r){const s=r[0],i=r[1],n=r[2];let o,a,c,l,f,h,_,d,u,g,T,p;return t===e?(e[12]=t[0]*s+t[4]*i+t[8]*n+t[12],e[13]=t[1]*s+t[5]*i+t[9]*n+t[13],e[14]=t[2]*s+t[6]*i+t[10]*n+t[14],e[15]=t[3]*s+t[7]*i+t[11]*n+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],f=t[4],h=t[5],_=t[6],d=t[7],u=t[8],g=t[9],T=t[10],p=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=f,e[5]=h,e[6]=_,e[7]=d,e[8]=u,e[9]=g,e[10]=T,e[11]=p,e[12]=o*s+f*i+u*n+t[12],e[13]=a*s+h*i+g*n+t[13],e[14]=c*s+_*i+T*n+t[14],e[15]=l*s+d*i+p*n+t[15]),e}function ur(e,t,r){const s=r[0],i=r[1],n=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ec(e,t,r,s){let i=s[0],n=s[1],o=s[2],a=Math.sqrt(i*i+n*n+o*o),c,l,f,h,_,d,u,g,T,p,A,R,E,b,C,I,D,P,O,W,z,H,F,Ie;return a<Ke?null:(a=1/a,i*=a,n*=a,o*=a,l=Math.sin(r),c=Math.cos(r),f=1-c,h=t[0],_=t[1],d=t[2],u=t[3],g=t[4],T=t[5],p=t[6],A=t[7],R=t[8],E=t[9],b=t[10],C=t[11],I=i*i*f+c,D=n*i*f+o*l,P=o*i*f-n*l,O=i*n*f-o*l,W=n*n*f+c,z=o*n*f+i*l,H=i*o*f+n*l,F=n*o*f-i*l,Ie=o*o*f+c,e[0]=h*I+g*D+R*P,e[1]=_*I+T*D+E*P,e[2]=d*I+p*D+b*P,e[3]=u*I+A*D+C*P,e[4]=h*O+g*W+R*z,e[5]=_*O+T*W+E*z,e[6]=d*O+p*W+b*z,e[7]=u*O+A*W+C*z,e[8]=h*H+g*F+R*Ie,e[9]=_*H+T*F+E*Ie,e[10]=d*H+p*F+b*Ie,e[11]=u*H+A*F+C*Ie,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function pi(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],a=t[6],c=t[7],l=t[8],f=t[9],h=t[10],_=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+l*s,e[5]=o*i+f*s,e[6]=a*i+h*s,e[7]=c*i+_*s,e[8]=l*i-n*s,e[9]=f*i-o*s,e[10]=h*i-a*s,e[11]=_*i-c*s,e}function Sc(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],c=t[3],l=t[8],f=t[9],h=t[10],_=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-l*s,e[1]=o*i-f*s,e[2]=a*i-h*s,e[3]=c*i-_*s,e[8]=n*s+l*i,e[9]=o*s+f*i,e[10]=a*s+h*i,e[11]=c*s+_*i,e}function Ri(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],c=t[3],l=t[4],f=t[5],h=t[6],_=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+l*s,e[1]=o*i+f*s,e[2]=a*i+h*s,e[3]=c*i+_*s,e[4]=l*i-n*s,e[5]=f*i-o*s,e[6]=h*i-a*s,e[7]=_*i-c*s,e}function bc(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=r+r,a=s+s,c=i+i,l=r*o,f=s*o,h=s*a,_=i*o,d=i*a,u=i*c,g=n*o,T=n*a,p=n*c;return e[0]=1-h-u,e[1]=f+p,e[2]=_-T,e[3]=0,e[4]=f-p,e[5]=1-l-u,e[6]=d+g,e[7]=0,e[8]=_+T,e[9]=d-g,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cc(e,t,r,s,i,n,o){const a=1/(r-t),c=1/(i-s),l=1/(n-o);return e[0]=n*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+s)*c,e[10]=(o+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*l,e[15]=0,e}function Mc(e,t,r,s,i){const n=1/Math.tan(t/2);if(e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){const o=1/(s-i);e[10]=(i+s)*o,e[14]=2*i*s*o}else e[10]=-1,e[14]=-2*s;return e}const Ic=Mc;function Nc(e,t,r,s,i,n,o){const a=1/(t-r),c=1/(s-i),l=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(i+s)*c,e[14]=(o+n)*l,e[15]=1,e}const Oc=Nc;function yc(e,t,r,s){let i,n,o,a,c,l,f,h,_,d;const u=t[0],g=t[1],T=t[2],p=s[0],A=s[1],R=s[2],E=r[0],b=r[1],C=r[2];return Math.abs(u-E)<Ke&&Math.abs(g-b)<Ke&&Math.abs(T-C)<Ke?Ac(e):(h=u-E,_=g-b,d=T-C,i=1/Math.sqrt(h*h+_*_+d*d),h*=i,_*=i,d*=i,n=A*d-R*_,o=R*h-p*d,a=p*_-A*h,i=Math.sqrt(n*n+o*o+a*a),i?(i=1/i,n*=i,o*=i,a*=i):(n=0,o=0,a=0),c=_*a-d*o,l=d*n-h*a,f=h*o-_*n,i=Math.sqrt(c*c+l*l+f*f),i?(i=1/i,c*=i,l*=i,f*=i):(c=0,l=0,f=0),e[0]=n,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=_,e[7]=0,e[8]=a,e[9]=f,e[10]=d,e[11]=0,e[12]=-(n*u+o*g+a*T),e[13]=-(c*u+l*g+f*T),e[14]=-(h*u+_*g+d*T),e[15]=1,e)}function Pc(){const e=new Re(4);return Re!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Fc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function dt(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3];return e[0]=r[0]*s+r[4]*i+r[8]*n+r[12]*o,e[1]=r[1]*s+r[5]*i+r[9]*n+r[13]*o,e[2]=r[2]*s+r[6]*i+r[10]*n+r[14]*o,e[3]=r[3]*s+r[7]*i+r[11]*n+r[15]*o,e}(function(){const e=Pc();return function(t,r,s,i,n,o){let a,c;for(r||(r=4),s||(s=0),i?c=Math.min(i*r+s,t.length):c=t.length,a=s;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],n(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var zt;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(zt||(zt={}));const mc=45*Math.PI/180,Dc=1,Ft=.1,mt=500,Bc=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class oe extends Tc{static get IDENTITY(){return xc()}static get ZERO(){return wc()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return zt}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,s,i,n,o,a,c,l,f,h,_,d,u,g,T){return this[0]=t,this[1]=r,this[2]=s,this[3]=i,this[4]=n,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=f,this[10]=h,this[11]=_,this[12]=d,this[13]=u,this[14]=g,this[15]=T,this.check()}setRowMajor(t,r,s,i,n,o,a,c,l,f,h,_,d,u,g,T){return this[0]=t,this[1]=n,this[2]=l,this[3]=d,this[4]=r,this[5]=o,this[6]=f,this[7]=u,this[8]=s,this[9]=a,this[10]=h,this[11]=g,this[12]=i,this[13]=c,this[14]=_,this[15]=T,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Bc)}fromObject(t){return this.check()}fromQuaternion(t){return bc(this,t),this.check()}frustum(t){const{left:r,right:s,bottom:i,top:n,near:o=Ft,far:a=mt}=t;return a===1/0?Uc(this,r,s,i,n,o):Cc(this,r,s,i,n,o,a),this.check()}lookAt(t){const{eye:r,center:s=[0,0,0],up:i=[0,1,0]}=t;return yc(this,r,s,i),this.check()}ortho(t){const{left:r,right:s,bottom:i,top:n,near:o=Ft,far:a=mt}=t;return Oc(this,r,s,i,n,o,a),this.check()}orthographic(t){const{fovy:r=mc,aspect:s=Dc,focalDistance:i=1,near:n=Ft,far:o=mt}=t;es(r);const a=r/2,c=i*Math.tan(a),l=c*s;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:n,far:o})}perspective(t){const{fovy:r=45*Math.PI/180,aspect:s=1,near:i=.1,far:n=500}=t;return es(r),Ic(this,r,s,i,n),this.check()}determinant(){return Rc(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const s=this.getScale(r),i=1/s[0],n=1/s[1],o=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*n,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*n,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*n,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const s=this.getScale(r),i=1/s[0],n=1/s[1],o=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*n,t[2]=this[2]*o,t[3]=this[4]*i,t[4]=this[5]*n,t[5]=this[6]*o,t[6]=this[8]*i,t[7]=this[9]*n,t[8]=this[10]*o,t}transpose(){return pc(this,this),this.check()}invert(){return jt(this,this),this.check()}multiplyLeft(t){return se(this,t,this),this.check()}multiplyRight(t){return se(this,this,t),this.check()}rotateX(t){return pi(this,this,t),this.check()}rotateY(t){return Sc(this,this,t),this.check()}rotateZ(t){return Ri(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return Ec(this,this,t,r),this.check()}scale(t){return ur(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return st(this,this,t),this.check()}transform(t,r){return t.length===4?(r=dt(r||[-0,-0,-0,-0],t,this),yt(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){const{length:s}=t;let i;switch(s){case 2:i=ec(r||[-0,-0],t,this);break;case 3:i=Ai(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return yt(i,t.length),i}transformAsVector(t,r){let s;switch(t.length){case 2:s=tc(r||[-0,-0],t,this);break;case 3:s=Ti(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return yt(s,t.length),s}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,s){return this.identity().translate([t,r,s])}}let ze,$e;function wc(){return ze||(ze=new oe([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ze)),ze}function xc(){return $e||($e=new oe,Object.freeze($e)),$e}function es(e){if(e>Math.PI*2)throw Error("expected radians")}function Uc(e,t,r,s,i,n){const o=2*n/(r-t),a=2*n/(i-s),c=(r+t)/(r-t),l=(i+s)/(i-s),f=-1,h=-1,_=-2*n;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=0,e[13]=0,e[14]=_,e[15]=0,e}const vc=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Wc={name:"fp32",vs:vc},kc=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Ei="#define SMOOTH_EDGE_RADIUS 0.5",Hc=`${Ei}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Xc=`${Ei}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Vc={name:"geometry",source:kc,vs:Hc,fs:Xc},jc=25;var x;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(x||(x={}));var U;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(U||(U={}));var M;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(M||(M={}));const t_="compute",r_="auto",zc="manipulation",$c="none",Lc="pan-x",Yc="pan-y";function Si(e){return e.trim().split(/\s+/g)}function Dt(e,t,r){if(e)for(const s of Si(t))e.addEventListener(s,r,!1)}function Bt(e,t,r){if(e)for(const s of Si(t))e.removeEventListener(s,r,!1)}function ts(e){return(e.ownerDocument||e).defaultView}function Kc(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}function bi(e){const t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,s=0,i=0;for(;i<t;)r+=e[i].clientX,s+=e[i].clientY,i++;return{x:Math.round(r/t),y:Math.round(s/t)}}function rs(e){const t=[];let r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:bi(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Ci(e,t){const r=t.x-e.x,s=t.y-e.y;return Math.sqrt(r*r+s*s)}function ss(e,t){const r=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(r*r+s*s)}function Zc(e,t){const r=t.x-e.x,s=t.y-e.y;return Math.atan2(s,r)*180/Math.PI}function is(e,t){const r=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.atan2(s,r)*180/Math.PI}function Mi(e,t){return e===t?U.None:Math.abs(e)>=Math.abs(t)?e<0?U.Left:U.Right:t<0?U.Up:U.Down}function qc(e,t){const r=t.center;let s=e.offsetDelta,i=e.prevDelta;const n=e.prevInput;return(t.eventType===x.Start||n?.eventType===x.End)&&(i=e.prevDelta={x:n?.deltaX||0,y:n?.deltaY||0},s=e.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-s.x),deltaY:i.y+(r.y-s.y)}}function Ii(e,t,r){return{x:t/e||0,y:r/e||0}}function Qc(e,t){return ss(t[0],t[1])/ss(e[0],e[1])}function Jc(e,t){return is(t[1],t[0])-is(e[1],e[0])}function Gc(e,t){const r=e.lastInterval||t,s=t.timeStamp-r.timeStamp;let i,n,o,a;if(t.eventType!==x.Cancel&&(s>jc||r.velocity===void 0)){const c=t.deltaX-r.deltaX,l=t.deltaY-r.deltaY,f=Ii(s,c,l);n=f.x,o=f.y,i=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,a=Mi(c,l),e.lastInterval=t}else i=r.velocity,n=r.velocityX,o=r.velocityY,a=r.direction;t.velocity=i,t.velocityX=n,t.velocityY=o,t.direction=a}function el(e,t){const{session:r}=e,{pointers:s}=t,{length:i}=s;r.firstInput||(r.firstInput=rs(t)),i>1&&!r.firstMultiple?r.firstMultiple=rs(t):i===1&&(r.firstMultiple=!1);const{firstInput:n,firstMultiple:o}=r,a=o?o.center:n.center,c=t.center=bi(s);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-n.timeStamp,t.angle=Zc(a,c),t.distance=Ci(a,c);const{deltaX:l,deltaY:f}=qc(r,t);t.deltaX=l,t.deltaY=f,t.offsetDirection=Mi(t.deltaX,t.deltaY);const h=Ii(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=o?Qc(o.pointers,s):1,t.rotation=o?Jc(o.pointers,s):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length;let _=e.element;return Kc(t.srcEvent.target,_)&&(_=t.srcEvent.target),t.target=_,Gc(r,t),t}function tl(e,t,r){const s=r.pointers.length,i=r.changedPointers.length,n=t&x.Start&&s-i===0,o=t&(x.End|x.Cancel)&&s-i===0;r.isFirst=!!n,r.isFinal=!!o,n&&(e.session={}),r.eventType=t;const a=el(e,r);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}let rl=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,r){tl(this.manager,t,r)}init(){Dt(this.element,this.evEl,this.domHandler),Dt(this.target,this.evTarget,this.domHandler),Dt(ts(this.element),this.evWin,this.domHandler)}destroy(){Bt(this.element,this.evEl,this.domHandler),Bt(this.target,this.evTarget,this.domHandler),Bt(ts(this.element),this.evWin,this.domHandler)}};const sl={pointerdown:x.Start,pointermove:x.Move,pointerup:x.End,pointercancel:x.Cancel,pointerout:x.Cancel},il="pointerdown",nl="pointermove pointerup pointercancel";class i_ extends rl{constructor(t){super(t),this.evEl=il,this.evWin=nl,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:r}=this;let s=!1;const i=sl[t.type],n=t.pointerType,o=n==="touch";let a=r.findIndex(c=>c.pointerId===t.pointerId);i&x.Start&&(t.buttons||o)?a<0&&(r.push(t),a=r.length-1):i&(x.End|x.Cancel)&&(s=!0),!(a<0)&&(r[a]=t,this.callback(i,{pointers:r,changedPointers:[t],eventType:i,pointerType:n,srcEvent:t}),s&&r.splice(a,1))}}let ol=1;function al(){return ol++}function ns(e){return e&M.Cancelled?"cancel":e&M.Ended?"end":e&M.Changed?"move":e&M.Began?"start":""}class Ni{constructor(t){this.options=t,this.id=al(),this.state=M.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const i of t)this.recognizeWith(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;const{simultaneous:s}=this;return s[r.id]||(s[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const s of t)this.dropRecognizeWith(s);return this}let r;return typeof t=="string"?r=this.manager.get(t):r=t,r&&delete this.simultaneous[r.id],this}requireFailure(t){if(Array.isArray(t)){for(const i of t)this.requireFailure(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;const{requireFail:s}=this;return s.indexOf(r)===-1&&(s.push(r),r.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const s of t)this.dropRequireFailure(s);return this}let r;if(typeof t=="string"?r=this.manager.get(t):r=t,r){const s=this.requireFail.indexOf(r);s>-1&&this.requireFail.splice(s,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:r}=this;r<M.Ended&&this.manager.emit(this.options.event+ns(r),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),r>=M.Ended&&this.manager.emit(this.options.event+ns(r),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=M.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(M.Failed|M.Possible)))return!1;t++}return!0}recognize(t){const r={...t};if(!this.options.enable){this.reset(),this.state=M.Failed;return}this.state&(M.Recognized|M.Cancelled|M.Failed)&&(this.state=M.Possible),this.state=this.process(r),this.state&(M.Began|M.Changed|M.Ended|M.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class Oi extends Ni{attrTest(t){const r=this.options.pointers;return r===0||t.pointers.length===r}process(t){const{state:r}=this,{eventType:s}=t,i=r&(M.Began|M.Changed),n=this.attrTest(t);return i&&(s&x.Cancel||!n)?r|M.Cancelled:i||n?s&x.End?r|M.Ended:r&M.Began?r|M.Changed:M.Began:M.Failed}}class os extends Ni{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[zc]}process(t){const{options:r}=this,s=t.pointers.length===r.pointers,i=t.distance<r.threshold,n=t.deltaTime<r.time;if(this.reset(),t.eventType&x.Start&&this.count===0)return this.failTimeout();if(i&&n&&s){if(t.eventType!==x.End)return this.failTimeout();const o=this.pTime?t.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||Ci(this.pCenter,t.center)<r.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!a||!o?this.count=1:this.count+=1,this._input=t,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=M.Recognized,this.tryEmit(this._input)},r.interval),M.Began):M.Recognized}return M.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=M.Failed},this.options.interval),M.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===M.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const cl=["","start","move","end","cancel","up","down","left","right"];class as extends Oi{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:U.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,r=[];return t&U.Horizontal&&r.push(Yc),t&U.Vertical&&r.push(Lc),r}getEventNames(){return cl.map(t=>this.options.event+t)}directionTest(t){const{options:r}=this;let s=!0,{distance:i}=t,{direction:n}=t;const o=t.deltaX,a=t.deltaY;return n&r.direction||(r.direction&U.Horizontal?(n=o===0?U.None:o<0?U.Left:U.Right,s=o!==this.pX,i=Math.abs(t.deltaX)):(n=a===0?U.None:a<0?U.Up:U.Down,s=a!==this.pY,i=Math.abs(t.deltaY))),t.direction=n,s&&i>r.threshold&&!!(n&r.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&M.Began)||!(this.state&M.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const r=U[t.direction].toLowerCase();r&&(t.additionalEvent=this.options.event+r),super.emit(t)}}const ll=["","start","move","end","cancel","in","out"];class fl extends Oi{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[$c]}getEventNames(){return ll.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&M.Began))}emit(t){if(t.scale!==1){const r=t.scale<1?"in":"out";t.additionalEvent=this.options.event+r}super.emit(t)}}class hl{constructor(t,r,s){this.element=t,this.callback=r,this.options=s}}const _l=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",dl=_l.indexOf("firefox")!==-1,cs=4.000244140625,ul=40,gl=.25;class n_ extends hl{constructor(t,r,s){super(t,r,{enable:!0,...s}),this.handleEvent=i=>{if(!this.options.enable)return;let n=i.deltaY;globalThis.WheelEvent&&(dl&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(n/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(n*=ul)),n!==0&&n%cs===0&&(n=Math.floor(n/cs)),i.shiftKey&&n&&(n=n*gl),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-n,srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,r){t==="wheel"&&(this.options.enable=r)}}const v={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(v,"IDENTITY",{get:()=>(rr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const K={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},it={common:0,meters:1,pixels:2},o_={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},a_={multipan:[as,{threshold:10,direction:U.Vertical,pointers:2}],pinch:[fl,{},null,["multipan"]],pan:[as,{threshold:1},["pinch"],["multipan"]],dblclick:[os,{event:"dblclick",taps:2}],click:[os,{event:"click"},null,["dblclick"]]};function Tl(e,t){if(e===t)return!0;if(Array.isArray(e)){const r=e.length;if(!t||t.length!==r)return!1;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}return!1}function Al(e){let t={},r;return s=>{for(const i in s)if(!Tl(s[i],t[i])){r=e(s),t=s;break}return r}}const ls=[0,0,0,0],pl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],yi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Rl=[0,0,0],Pi=[0,0,0],El=Al(Ml);function Sl(e,t,r=Pi){r.length<3&&(r=[r[0],r[1],0]);let s=r,i,n=!0;switch(t===v.LNGLAT_OFFSETS||t===v.METER_OFFSETS?i=r:i=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case K.WEB_MERCATOR:(t===v.LNGLAT||t===v.CARTESIAN)&&(i=[0,0,0],n=!1);break;case K.WEB_MERCATOR_AUTO_OFFSET:t===v.LNGLAT?s=i:t===v.CARTESIAN&&(s=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(s),s[0]-=r[0],s[1]-=r[1],s[2]-=r[2]);break;case K.IDENTITY:s=e.position.map(Math.fround),s[2]=s[2]||0;break;case K.GLOBE:n=!1,i=null;break;default:n=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:s,offsetMode:n}}function bl(e,t,r){const{viewMatrixUncentered:s,projectionMatrix:i}=e;let{viewMatrix:n,viewProjectionMatrix:o}=e,a=ls,c=ls,l=e.cameraPosition;const{geospatialOrigin:f,shaderCoordinateOrigin:h,offsetMode:_}=Sl(e,t,r);return _&&(c=e.projectPosition(f||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=dt([],c,o),n=s||n,o=se([],i,n),o=se([],o,pl)),{viewMatrix:n,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:f}}function Cl({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:s=v.DEFAULT,coordinateOrigin:i=Pi,autoWrapLongitude:n=!1}){s===v.DEFAULT&&(s=e.isGeospatial?v.LNGLAT:v.CARTESIAN);const o=El({viewport:e,devicePixelRatio:t,coordinateSystem:s,coordinateOrigin:i});return o.wrapLongitude=n,o.modelMatrix=r||yi,o}function Ml({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:s}){const{projectionCenter:i,viewProjectionMatrix:n,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=bl(e,r,s),f=e.getDistanceScales(),h=[e.width*t,e.height*t],_=dt([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:c,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!e._pseudoMeters,viewportSize:h,devicePixelRatio:t,focalDistance:_,commonUnitsPerMeter:f.unitsPerMeter,commonUnitsPerWorldUnit:f.unitsPerMeter,commonUnitsPerWorldUnit2:Rl,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:n,modelMatrix:yi,cameraPosition:a};if(l){const u=e.getDistanceScales(l);switch(r){case v.METER_OFFSETS:d.commonUnitsPerWorldUnit=u.unitsPerMeter,d.commonUnitsPerWorldUnit2=u.unitsPerMeter2;break;case v.LNGLAT:case v.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=u.unitsPerMeter),d.commonUnitsPerWorldUnit=u.unitsPerDegree,d.commonUnitsPerWorldUnit2=u.unitsPerDegree2;break;case v.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,u.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,u.unitsPerMeter2[2]];break}}return d}const Il=Object.keys(v).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${v[e]};`).join(""),Nl=Object.keys(K).map(e=>`const PROJECTION_MODE_${e}: i32 = ${K[e]};`).join(""),Ol=Object.keys(it).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${it[e]};`).join(""),yl=`${Il}
${Nl}
${Ol}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Pl=`${yl}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Fl=Object.keys(v).map(e=>`const int COORDINATE_SYSTEM_${e} = ${v[e]};`).join(""),ml=Object.keys(K).map(e=>`const int PROJECTION_MODE_${e} = ${K[e]};`).join(""),Dl=Object.keys(it).map(e=>`const int UNIT_${e.toUpperCase()} = ${it[e]};`).join(""),Bl=`${Fl}
${ml}
${Dl}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,wl={};function xl(e=wl){return"viewport"in e?Cl(e):{}}const c_={name:"project",dependencies:[Wc,Vc],source:Pl,vs:Bl,getUniforms:xl,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};function Ul(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ae(e,t){const r=dt([],t,e);return Fc(r,r,1/r[3]),r}function l_(e,t){const r=e%t;return r<0?t+r:r}function $t(e,t,r){return e<t?t:e>r?r:e}function vl(e){return Math.log(e)*Math.LOG2E}const Fi=Math.log2||vl;function J(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Z=Math.PI,mi=Z/4,Y=Z/180,Lt=180/Z,Se=512,nt=4003e4,fs=85.051129,Wl=1.5;function kl(e){return Fi(e)}function ot(e){const[t,r]=e;J(Number.isFinite(t)),J(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const s=t*Y,i=r*Y,n=Se*(s+Z)/(2*Z),o=Se*(Z+Math.log(Math.tan(mi+i*.5)))/(2*Z);return[n,o]}function ut(e){const[t,r]=e,s=t/Se*(2*Z)-Z,i=2*(Math.atan(Math.exp(r/Se*(2*Z)-Z))-mi);return[s*Lt,i*Lt]}function Hl(e){const{latitude:t}=e;J(Number.isFinite(t));const r=Math.cos(t*Y);return kl(nt*r)-9}function wt(e){const t=Math.cos(e*Y);return Se/nt/t}function Yt(e){const{latitude:t,longitude:r,highPrecision:s=!1}=e;J(Number.isFinite(t)&&Number.isFinite(r));const i=Se,n=Math.cos(t*Y),o=i/360,a=o/n,c=i/nt/n,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(s){const f=Y*Math.tan(t*Y)/n,h=o*f/2,_=i/nt*f,d=_/a*c;l.unitsPerDegree2=[0,h,_],l.unitsPerMeter2=[d,0,d]}return l}function Xl(e,t){const[r,s,i]=e,[n,o,a]=t,{unitsPerMeter:c,unitsPerMeter2:l}=Yt({longitude:r,latitude:s,highPrecision:!0}),f=ot(e);f[0]+=n*(c[0]+l[0]*o),f[1]+=o*(c[1]+l[1]*o);const h=ut(f),_=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],_]:h}function Vl(e){const{height:t,pitch:r,bearing:s,altitude:i,scale:n,center:o}=e,a=Ul();st(a,a,[0,0,-i]),pi(a,a,-r*Y),Ri(a,a,s*Y);const c=n/t;return ur(a,a,[c,c,c]),o&&st(a,a,ac([],o)),a}function jl(e){const{width:t,height:r,altitude:s,pitch:i=0,offset:n,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=e;let{fovy:f=at(Wl)}=e;s!==void 0&&(f=at(s));const h=f*Y,_=i*Y,d=Di(f);let u=d;o&&(u+=o[2]*a/Math.cos(_)/r);const g=h*(.5+(n?n[1]:0)/r),T=Math.sin(g)*u/Math.sin($t(Math.PI/2-_-g,.01,Math.PI-.01)),p=Math.sin(_)*T+u,A=u*10,R=Math.min(p*l,A);return{fov:h,aspect:t/r,focalDistance:d,near:c,far:R}}function at(e){return 2*Math.atan(.5/e)*Lt}function Di(e){return .5/Math.tan(.5*e*Y)}function zl(e,t){const[r,s,i=0]=e;return J(Number.isFinite(r)&&Number.isFinite(s)&&Number.isFinite(i)),Ae(t,[r,s,i,1])}function Bi(e,t,r=0){const[s,i,n]=e;if(J(Number.isFinite(s)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(n))return Ae(t,[s,i,n,1]);const o=Ae(t,[s,i,0,1]),a=Ae(t,[s,i,1,1]),c=o[2],l=a[2],f=c===l?0:((r||0)-c)/(l-c);return gi([],o,a,f)}function $l(e){const{width:t,height:r,bounds:s,minExtent:i=0,maxZoom:n=24,offset:o=[0,0]}=e,[[a,c],[l,f]]=s,h=Ll(e.padding),_=ot([a,$t(f,-85.051129,fs)]),d=ot([l,$t(c,-85.051129,fs)]),u=[Math.max(Math.abs(d[0]-_[0]),i),Math.max(Math.abs(d[1]-_[1]),i)],g=[t-h.left-h.right-Math.abs(o[0])*2,r-h.top-h.bottom-Math.abs(o[1])*2];J(g[0]>0&&g[1]>0);const T=g[0]/u[0],p=g[1]/u[1],A=(h.right-h.left)/2/T,R=(h.top-h.bottom)/2/p,E=[(d[0]+_[0])/2+A,(d[1]+_[1])/2+R],b=ut(E),C=Math.min(n,Fi(Math.abs(Math.min(T,p))));return J(Number.isFinite(C)),{longitude:b[0],latitude:b[1],zoom:C}}function Ll(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(J(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const hs=Math.PI/180;function Yl(e,t=0){const{width:r,height:s,unproject:i}=e,n={targetZ:t},o=i([0,s],n),a=i([r,s],n);let c,l;const f=e.fovy?.5*e.fovy*hs:Math.atan(.5/e.altitude),h=(90-e.pitch)*hs;return f>h-.01?(c=_s(e,0,t),l=_s(e,r,t)):(c=i([0,0],n),l=i([r,0],n)),[o,a,l,c]}function _s(e,t,r){const{pixelUnprojectionMatrix:s}=e,i=Ae(s,[t,0,1,1]),n=Ae(s,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-i[2])/(n[2]-i[2]),c=gi([],i,n,a),l=ut(c);return l.push(r),l}class Kl{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:s=1,type:i,padding:n=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=i||t&&t.constructor||Float32Array,f=r*s+n;if(ArrayBuffer.isView(t)){if(f<=t.length)return t;if(f*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new l(t.buffer,0,f)}let h=1/0;c&&(h=c*s+n);const _=this._allocate(l,f,a,h);return t&&o?_.set(t):a||_.fill(0,0,4),this._release(t),_}release(t){this._release(t)}_allocate(t,r,s,i){let n=Math.max(Math.ceil(r*this.opts.overAlloc),1);n>i&&(n=i);const o=this._pool,a=t.BYTES_PER_ELEMENT*n,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new t(o.splice(c,1)[0],0,n);return s&&l.fill(0),l}return new t(n)}_release(t){if(!ArrayBuffer.isView(t))return;const r=this._pool,{buffer:s}=t,{byteLength:i}=s,n=r.findIndex(o=>o.byteLength>=i);n<0?r.push(s):(n>0||r.length<this.opts.poolSize)&&r.splice(n,0,s),r.length>this.opts.poolSize&&r.shift()}}const Zl=new Kl;function Fe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function f_(e,t){const r=e%t;return r<0?t+r:r}function ql(e){return[e[12],e[13],e[14]]}function Ql(e){return{left:_e(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:_e(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:_e(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:_e(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:_e(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:_e(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const ds=new Ee;function _e(e,t,r,s){ds.set(e,t,r);const i=ds.len();return{distance:s/i,normal:new Ee(-e/i,-t/i,-r/i)}}function Jl(e){return e-Math.fround(e)}let Oe;function h_(e,t){const{size:r=1,startIndex:s=0}=t,i=t.endIndex!==void 0?t.endIndex:e.length,n=(i-s)/r;Oe=Zl.allocate(Oe,n,{type:Float32Array,size:r*2});let o=s,a=0;for(;o<i;){for(let c=0;c<r;c++){const l=e[o++];Oe[a+c]=l,Oe[a+c+r]=Jl(l)}a+=r*2}return Oe.subarray(0,n*r*2)}function __(e){let t=null,r=!1;for(const s of e)s&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],s[0][0]),t[0][1]=Math.min(t[0][1],s[0][1]),t[1][0]=Math.max(t[1][0],s[1][0]),t[1][1]=Math.max(t[1][1],s[1][1])):t=s);return t}const Gl=Math.PI/180,ef=Fe(),us=[0,0,0],tf={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function rf({width:e,height:t,orthographic:r,fovyRadians:s,focalDistance:i,padding:n,near:o,far:a}){const c=e/t,l=r?new oe().orthographic({fovy:s,aspect:c,focalDistance:i,near:o,far:a}):new oe().perspective({fovy:s,aspect:c,near:o,far:a});if(n){const{left:f=0,right:h=0,top:_=0,bottom:d=0}=n,u=tt((f+e-h)/2,0,e)-e/2,g=tt((_+t-d)/2,0,t)-t/2;l[8]-=u*2/e,l[9]+=g*2/t}return l}class gt{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||tf,this.focalDistance=t.focalDistance||1,this.position=t.position||us,this.modelMatrix=t.modelMatrix||null;const{longitude:r,latitude:s}=t;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?K.WEB_MERCATOR:K.WEB_MERCATOR_AUTO_OFFSET:K.IDENTITY}equals(t){return t instanceof gt?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&rt(t.projectionMatrix,this.projectionMatrix)&&rt(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){const s=this.projectPosition(t),i=zl(s,this.pixelProjectionMatrix),[n,o]=i,a=r?o:this.height-o;return t.length===2?[n,a]:[n,a,i[2]]}unproject(t,{topLeft:r=!0,targetZ:s}={}){const[i,n,o]=t,a=r?n:this.height-n,c=s&&s*this.distanceScales.unitsPerMeter[2],l=Bi([i,a,o],this.pixelUnprojectionMatrix,c),[f,h,_]=this.unprojectPosition(l);return Number.isFinite(o)?[f,h,_]:Number.isFinite(s)?[f,h,s]:[f,h]}projectPosition(t){const[r,s]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,s,i]}unprojectPosition(t){const[r,s]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,s,i]}projectFlat(t){if(this.isGeospatial){const r=ot(t);return r[1]=tt(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?ut(t):t}getBounds(t={}){const r={targetZ:t.z||0},s=this.unproject([0,0],r),i=this.unproject([this.width,0],r),n=this.unproject([0,this.height],r),o=this.unproject([this.width,this.height],r);return[Math.min(s[0],i[0],n[0],o[0]),Math.min(s[1],i[1],n[1],o[1]),Math.max(s[0],i[0],n[0],o[0]),Math.max(s[1],i[1],n[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?Yt({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:s=1,height:i=1}){return t<this.x+this.width&&this.x<t+s&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Ql(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){const r=t.longitude,s=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=Hl({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Yt({latitude:s,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:n,modelMatrix:o}=t;let a=us;if(n&&(a=o?new oe(o).transformAsVector(n,[]):n),this.isGeospatial){const c=this.projectPosition([r,s,0]);this.center=new Ee(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:r=ef,projectionMatrix:s=null,orthographic:i=!1,fovyRadians:n,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:f=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new oe().multiplyRight(r).translate(new Ee(this.center).negate()),this.projectionMatrix=s||rf({width:this.width,height:this.height,orthographic:i,fovyRadians:n||o*Gl,focalDistance:f,padding:l,near:a,far:c});const h=Fe();se(h,h,this.projectionMatrix),se(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=jt([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=ql(this.viewMatrixInverse);const _=Fe(),d=Fe();ur(_,_,[this.width/2,-this.height/2,1]),st(_,_,[1,-1,0]),se(d,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=jt(Fe(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||rr.warn("Pixel project matrix not invertible")()}}gt.displayName="Viewport";class ct extends gt{constructor(t={}){const{latitude:r=0,longitude:s=0,zoom:i=0,pitch:n=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:f,orthographic:h=!1,projectionMatrix:_,repeat:d=!1,worldOffset:u=0,position:g,padding:T,legacyMeterSizes:p=!1}=t;let{width:A,height:R,altitude:E=1.5}=t;const b=Math.pow(2,i);A=A||1,R=R||1;let C,I=null;if(_)E=_[5]/2,C=at(E);else{t.fovy?(C=t.fovy,E=Di(C)):C=at(E);let P;if(T){const{top:O=0,bottom:W=0}=T;P=[0,tt((O+R-W)/2,0,R)-R/2]}I=jl({width:A,height:R,scale:b,center:g&&[0,0,g[2]*wt(r)],offset:P,pitch:n,fovy:C,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(I.near=l),Number.isFinite(f)&&(I.far=f)}let D=Vl({height:R,pitch:n,bearing:o,scale:b,altitude:E});u&&(D=new oe().translate([512*u,0,0]).multiplyLeft(D)),super({...t,width:A,height:R,viewMatrix:D,longitude:s,latitude:r,zoom:i,...I,fovy:C,focalDistance:E}),this.latitude=r,this.longitude=s,this.zoom=i,this.pitch=n,this.bearing=o,this.altitude=E,this.fovy=C,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=p,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),r=Math.floor((t[0]+180)/360),s=Math.ceil((t[2]-180)/360);for(let i=r;i<=s;i++){const n=i?new ct({...this,worldOffset:i}):this;this._subViewports.push(n)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[r,s]=this.projectFlat(t),i=(t[2]||0)*wt(t[1]);return[r,s,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[r,s]=this.unprojectFlat(t),i=(t[2]||0)/wt(s);return[r,s,i]}addMetersToLngLat(t,r){return Xl(t,r)}panByPosition(t,r){const s=Bi(r,this.pixelUnprojectionMatrix),i=this.projectFlat(t),n=Gr([],i,Ga([],s)),o=Gr([],this.center,n),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(t={}){const r=Yl(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){const{width:s,height:i}=this,{longitude:n,latitude:o,zoom:a}=$l({width:s,height:i,bounds:t,...r});return new ct({width:s,height:i,longitude:n,latitude:o,zoom:a})}}ct.displayName="WebMercatorViewport";function sf(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nf(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function of(e){return sf(e)||nf(e)}const d_={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},u_=Symbol.for("component"),g_=Symbol.for("propTypes"),T_=Symbol.for("deprecatedProps"),A_=Symbol.for("asyncPropDefaults"),p_=Symbol.for("asyncPropOriginal"),R_=Symbol.for("asyncPropResolved");function E_(e,t=()=>!0){return Array.isArray(e)?wi(e,t,[]):t(e)?[e]:[]}function wi(e,t,r){let s=-1;for(;++s<e.length;){const i=e[s];Array.isArray(i)?wi(i,t,r):t(i)&&r.push(i)}return r}function S_({target:e,source:t,start:r=0,count:s=1}){const i=t.length,n=s*i;let o=0;for(let a=r;o<i;o++)e[a++]=t[o];for(;o<n;)o<n-o?(e.copyWithin(r+o,r,r+o),o*=2):(e.copyWithin(r+o,r,r+n-o),o=n);return e}function gs(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!gs(e[s],t[s],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const n of s)if(!t.hasOwnProperty(n)||!gs(e[n],t[n],r-1))return!1;return!0}return!1}class b_{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}function C_(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var de;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(de||(de={}));const gr={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},w=(e,t,r)=>t?e.enable(r):e.disable(r),Ts=(e,t,r)=>e.hint(r,t),X=(e,t,r)=>e.pixelStorei(r,t),As=(e,t,r)=>{const s=r===36006?36009:36008;return e.bindFramebuffer(s,t)},ye=(e,t,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];e.bindBuffer(i,t)};function xt(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const af={3042:w,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:w,2885:(e,t)=>e.cullFace(t),2929:w,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:w,35723:Ts,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:As,36010:As,34964:ye,36662:ye,36663:ye,35053:ye,35055:ye,2886:(e,t)=>e.frontFace(t),33170:Ts,2849:(e,t)=>e.lineWidth(t),32823:w,32824:"polygonOffset",10752:"polygonOffset",35977:w,32926:w,32928:w,32938:"sampleCoverage",32939:"sampleCoverage",3089:w,3088:(e,t)=>e.scissor(...t),2960:w,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:w,10754:w,12288:w,12289:w,12290:w,12291:w,12292:w,12293:w,12294:w,12295:w,3333:X,3317:X,37440:X,37441:X,37443:X,3330:X,3332:X,3331:X,3314:X,32878:X,3316:X,3315:X,32877:X,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{const r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=xt(t)?t:[t,t];const[r,s]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,s)},stencilFunc:(e,t)=>{t=xt(t)&&t.length===3?[...t,...t]:t;const[r,s,i,n,o,a]=t;e.stencilFuncSeparate(1028,r,s,i),e.stencilFuncSeparate(1029,n,o,a)},stencilOp:(e,t)=>{t=xt(t)&&t.length===3?[...t,...t]:t;const[r,s,i,n,o,a]=t;e.stencilOpSeparate(1028,r,s,i),e.stencilOpSeparate(1029,n,o,a)},viewport:(e,t)=>e.viewport(...t)};function B(e,t,r){return t[e]!==void 0?t[e]:r[e]}const cf={blendEquation:(e,t,r)=>e.blendEquationSeparate(B(32777,t,r),B(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(B(32969,t,r),B(32968,t,r),B(32971,t,r),B(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(B(32824,t,r),B(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(B(32938,t,r),B(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,B(2962,t,r),B(2967,t,r),B(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,B(34816,t,r),B(36003,t,r),B(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,B(2964,t,r),B(2965,t,r),B(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,B(34817,t,r),B(34818,t,r),B(34819,t,r))},ps={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return s?e({[s]:r}):{valueChanged:!0}},blendColor:(e,t,r,s,i)=>e({32773:new Float32Array([t,r,s,i])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,s,i)=>e({32969:t,32968:r,32971:s,32970:i}),clearColor:(e,t,r,s,i)=>e({3106:new Float32Array([t,r,s,i])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,s,i)=>e({3107:[t,r,s,i]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,s,i)=>e({3088:new Int32Array([t,r,s,i])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,s)=>e({2962:t,2967:r,2963:s,34816:t,36003:r,36004:s}),stencilFuncSeparate:(e,t,r,s,i)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:s,[t===1028?2963:36004]:i}),stencilOp:(e,t,r,s)=>e({2964:t,2965:r,2966:s,34817:t,34818:r,34819:s}),stencilOpSeparate:(e,t,r,s,i)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:s,[t===1028?2966:34819]:i}),viewport:(e,t,r,s,i)=>e({2978:[t,r,s,i]})},Q=(e,t)=>e.isEnabled(t),Rs={3042:Q,2884:Q,2929:Q,3024:Q,32823:Q,32926:Q,32928:Q,3089:Q,2960:Q,35977:Q},lf=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Me(e,t){if(hf(t))return;const r={};for(const i in t){const n=Number(i),o=af[i];o&&(typeof o=="string"?r[o]=!0:o(e,t[i],n))}const s=e.state&&e.state.cache;if(s)for(const i in r){const n=cf[i];n(e,t,s)}}function xi(e,t=gr){if(typeof t=="number"){const i=t,n=Rs[i];return n?n(e,i):e.getParameter(i)}const r=Array.isArray(t)?t:Object.keys(t),s={};for(const i of r){const n=Rs[i];s[i]=n?n(e,Number(i)):e.getParameter(Number(i))}return s}function ff(e){Me(e,gr)}function hf(e){for(const t in e)return!1;return!0}function _f(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),s=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&s&&e.length===t.length){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}return!1}class ie{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,r){this.gl=t,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];Me(this.gl,t),this.stateStack.pop()}trackState(t,r){if(this.cache=r.copyState?xi(t):Object.assign({},gr),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,uf(t);for(const s in ps){const i=ps[s];df(t,s,i)}Es(t,"getParameter"),Es(t,"isEnabled")}_updateCache(t){let r=!1,s;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const n in t){const o=t[n],a=this.cache[n];_f(o,a)||(r=!0,s=a,i&&!(n in i)&&(i[n]=a),this.cache[n]=o)}return{valueChanged:r,oldValue:s}}}function Es(e,t){const r=e[t].bind(e);e[t]=function(i){if(i===void 0||lf.has(i))return r(i);const n=ie.get(e);return i in n.cache||(n.cache[i]=r(i)),n.enable?n.cache[i]:r(i)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function df(e,t,r){if(!e[t])return;const s=e[t].bind(e);e[t]=function(...n){const o=ie.get(e),{valueChanged:a,oldValue:c}=r(o._updateCache,...n);return a&&s(...n),c},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function uf(e){const t=e.useProgram.bind(e);e.useProgram=function(s){const i=ie.get(e);i.program!==s&&(t(s),i.program=s)}}function gf(e,t,r){let s="";const i={preserveDrawingBuffer:!0,...r};let n=null;if(n||=e.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(s||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!n&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,n=e.getContext("webgl2",i),n.luma||={},n.luma.softwareRenderer=!0),n||(n=e.getContext("webgl",{}),n&&(n=null,s||="Your browser only supports WebGL1")),!n)throw s||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${s}`);const{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",c=>o(c),!1),e.addEventListener("webglcontextrestored",c=>a(c),!1),n.luma||={},n}function be(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function Tf(e,t){const r=e.getParameter(7936),s=e.getParameter(7937);be(e,"WEBGL_debug_renderer_info",t);const i=t.WEBGL_debug_renderer_info,n=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=n||r,c=o||s,l=e.getParameter(7938),f=Ui(a,c),h=Af(a,c),_=pf(a,c);return{type:"webgl",gpu:f,gpuType:_,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Ui(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Af(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function pf(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Ui(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function vi(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const me="WEBGL_compressed_texture_s3tc",De="WEBGL_compressed_texture_s3tc_srgb",ue="EXT_texture_compression_rgtc",ge="EXT_texture_compression_bptc",Rf="WEBGL_compressed_texture_etc",Ef="WEBGL_compressed_texture_astc",Sf="WEBGL_compressed_texture_etc1",bf="WEBGL_compressed_texture_pvrtc",Cf="WEBGL_compressed_texture_atc",Ss="EXT_texture_norm16",bs="EXT_render_snorm",Mf="EXT_color_buffer_float",Tr={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[bs],"norm16-renderable-webgl":[Ss],"snorm16-renderable-webgl":[Ss,bs],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[me,De,ue,ge],"texture-compression-bc5-webgl":[ue],"texture-compression-bc7-webgl":[ge],"texture-compression-etc2":[Rf],"texture-compression-astc":[Ef],"texture-compression-etc1-webgl":[Sf],"texture-compression-pvrtc-webgl":[bf],"texture-compression-atc-webgl":[Cf]};function If(e){return e in Tr}function Nf(e,t,r){return(Tr[t]||[]).every(i=>be(e,i,r))}const Ar={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Mf,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:me},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:De},"bc1-rgba-unorm":{gl:33777,x:me},"bc1-rgba-unorm-srgb":{gl:35916,x:De},"bc2-rgba-unorm":{gl:33778,x:me},"bc2-rgba-unorm-srgb":{gl:35918,x:De},"bc3-rgba-unorm":{gl:33779,x:me},"bc3-rgba-unorm-srgb":{gl:35919,x:De},"bc4-r-unorm":{gl:36283,x:ue},"bc4-r-snorm":{gl:36284,x:ue},"bc5-rg-unorm":{gl:36285,x:ue},"bc5-rg-snorm":{gl:36286,x:ue},"bc6h-rgb-ufloat":{gl:36495,x:ge},"bc6h-rgb-float":{gl:36494,x:ge},"bc7-rgba-unorm":{gl:36492,x:ge},"bc7-rgba-unorm-srgb":{gl:36493,x:ge},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Of(e,t,r){let s=t.create;const i=Ar[t.format];return i?.gl===void 0&&(s=!1),i?.x&&(s=s&&!!be(e,i.x,r)),{format:t.format,create:s&&t.create,render:s&&t.render,filter:s&&t.filter,blend:s&&t.blend,store:s&&t.store}}function Wi(e){const t=Ar[e],r=Ff(e),s=ir(e);return{internalFormat:r,format:t?.dataFormat||Pf(s.channels,s.integer,s.normalized,r),type:s.dataType?vi(s.dataType):t?.types?.[0]||5121,compressed:s.compressed||!1}}function yf(e){switch(ir(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function Pf(e,t,r,s){if(s===6408||s===6407)return s;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Ff(e){const r=Ar[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}const Cs={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class mf extends Ea{gl;extensions;testedFeatures=new Set;constructor(t,r,s){super([],s),this.gl=t,this.extensions=r,be(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),If(t)&&Nf(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(Cs),...Object.keys(Tr)]}getWebGLFeature(t){const r=Cs[t];return typeof r=="string"?!!be(this.gl,r,this.extensions):!!r}}class Df extends Ra{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class we extends _t{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,r){super(t,r);const s=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const s=this.colorAttachments[r];if(s){const i=36064+r;this._attachTextureView(i,s)}}if(this.depthStencilAttachment){const r=yf(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${wf(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:s}=this.device,{texture:i}=r,n=r.props.baseMipLevel,o=r.props.baseArrayLayer;switch(s.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,i.handle,n,o);break;case 34067:const a=Bf(o);s.framebufferTexture2D(36160,t,a,i.handle,n);break;case 3553:s.framebufferTexture2D(36160,t,3553,i.handle,n);break;default:throw new Error("Illegal texture type")}s.bindTexture(i.glTarget,null)}}function Bf(e){return e<34069?e+34069:e}function wf(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}class xf extends nr{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new we(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function ki(e,t){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",e),new Promise((i,n)=>{s.onload=i,s.onerror=o=>n(new Error(`Unable to load script '${e}': ${o}`)),r.appendChild(s)})}const Uf=1;let V=null,Ms=!1;const Hi={debugSpectorJS:S.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function M_(e){if(!globalThis.SPECTOR)try{await ki(e.debugSpectorJSUrl||Hi.debugSpectorJSUrl)}catch(t){S.warn(String(t))}}function vf(e){if(e={...Hi,...e},!e.debugSpectorJS)return null;if(!V&&globalThis.SPECTOR&&!globalThis.luma?.spector){S.probe(Uf,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;V=new t,globalThis.luma&&(globalThis.luma.spector=V)}if(!V)return null;if(Ms||(Ms=!0,V.spyCanvases(),V?.onCaptureStarted.add(t=>S.info("Spector capture started:",t)()),V?.onCapture.add(t=>{S.info("Spector capture complete:",t)(),V?.getResultUI(),V?.resultView.display(),V?.resultView.addCapture(t)})),e.gl){const t=e.gl,r=t.device;V?.startCapture(e.gl,500),t.device=r,new Promise(s=>setTimeout(s,2e3)).then(s=>{S.info("Spector capture stopped after 2 seconds")(),V?.stopCapture()})}return V}const Wf="https://unpkg.com/webgl-debug@2.0.1/index.js";function Xi(e){return e.luma=e.luma||{},e.luma}async function I_(){Ce()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await ki(Wf))}function kf(e,t={}){return t.debugWebGL||t.traceWebGL?Xf(e,t):Hf(e)}function Hf(e){const t=Xi(e);return t.realContext?t.realContext:e}function Xf(e,t){if(!globalThis.WebGLDebugUtils)return S.warn("webgl-debug not loaded")(),e;const r=Xi(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...de,...e});const s=globalThis.WebGLDebugUtils.makeDebugContext(e,Vf.bind(null,t),jf.bind(null,t));for(const o in de)!(o in s)&&typeof de[o]=="number"&&(s[o]=de[o]);class i{}Object.setPrototypeOf(s,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,s);const n=Object.create(i);return r.realContext=e,r.debugContext=n,n.debug=!0,n}function Is(e,t){t=Array.from(t).map(s=>s===void 0?"undefined":s);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function Vf(e,t,r,s){s=Array.from(s).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(t),n=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,s),o=`${i} in gl.${r}(${n})`;S.error(o)();debugger}function jf(e,t,r){let s="";S.level>=1&&(s=Is(t,r),e.traceWebGL&&S.log(1,s)());for(const i of r)if(i===void 0){s=s||Is(t,r);debugger}}const Ut={};function zf(e="id"){Ut[e]=Ut[e]||1;const t=Ut[e]++;return`${e}-${t}`}class xe extends ${device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=$f(this.props.usage),this.glUsage=Lf(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,s=t.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,s,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const s=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,r),s}}function $f(e){return e&$.INDEX?34963:e&$.VERTEX?34962:e&$.UNIFORM?35345:34962}function Lf(e){return e&$.INDEX||e&$.VERTEX?35044:e&$.UNIFORM?35048:35044}function Yf(e){const t=e.split(/\r?\n/),r=[];for(const s of t){if(s.length<=1)continue;const i=s.split(":");if(i.length===2){const[h,_]=i;r.push({message:_.trim(),type:Ns(h),lineNum:0,linePos:0});continue}const[n,o,a,...c]=i;let l=parseInt(a,10);isNaN(l)&&(l=0);let f=parseInt(o,10);isNaN(f)&&(f=0),r.push({message:c.join(":").trim(),type:Ns(n),lineNum:l,linePos:f})}return r}function Ns(e){const t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}class Kf extends ar{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?Yf(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}S.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),S.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async i=>await new Promise(n=>setTimeout(n,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Zf(e,t,r,s){if(Gf(t))return s(e);const i=e;i.pushState();try{return qf(e,t),Me(i.gl,r),s(e)}finally{i.popState()}}function qf(e,t){const r=e,{gl:s}=r;if(t.cullMode)switch(t.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029);break}if(t.frontFace&&s.frontFace(ne("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&s.enable(34383),t.depthBias!==void 0&&(s.enable(32823),s.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const n=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=ne("provokingVertex",t.provokingVertex,{first:36429,last:36430});n?.provokingVertexWEBGL(o)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const n=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=ne("polygonMode",t.polygonMode,{fill:6914,line:6913});n?.polygonModeWEBGL(1028,o),n?.polygonModeWEBGL(1029,o)}t.polygonOffsetLine&&s.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&s.enable(12288),t.clipDistance1&&s.enable(12289),t.clipDistance2&&s.enable(12290),t.clipDistance3&&s.enable(12291),t.clipDistance4&&s.enable(12292),t.clipDistance5&&s.enable(12293),t.clipDistance6&&s.enable(12294),t.clipDistance7&&s.enable(12295)),t.depthWriteEnabled!==void 0&&s.depthMask(Jf("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?s.enable(2929):s.disable(2929),s.depthFunc(Kt("depthCompare",t.depthCompare))),t.stencilWriteMask){const i=t.stencilWriteMask;s.stencilMaskSeparate(1028,i),s.stencilMaskSeparate(1029,i)}if(t.stencilReadMask&&S.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const i=t.stencilReadMask||4294967295,n=Kt("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,n,0,i),s.stencilFuncSeparate(1029,n,0,i)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const i=vt("stencilPassOperation",t.stencilPassOperation),n=vt("stencilFailOperation",t.stencilFailOperation),o=vt("stencilDepthFailOperation",t.stencilDepthFailOperation);s.stencilOpSeparate(1028,n,o,i),s.stencilOpSeparate(1029,n,o,i)}switch(t.blend){case!0:s.enable(3042);break;case!1:s.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const i=Os("blendColorOperation",t.blendColorOperation||"add"),n=Os("blendAlphaOperation",t.blendAlphaOperation||"add");s.blendEquationSeparate(i,n);const o=Le("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=Le("blendColorDstFactor",t.blendColorDstFactor||"zero"),c=Le("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),l=Le("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");s.blendFuncSeparate(o,a,c,l)}}function Kt(e,t){return ne(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function vt(e,t){return ne(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Os(e,t){return ne(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Le(e,t){return ne(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Qf(e,t){return`Illegal parameter ${t} for ${e}`}function ne(e,t,r){if(!(t in r))throw new Error(Qf(e,t));return r[t]}function Jf(e,t){return t}function Gf(e){let t=!0;for(const r in e){t=!1;break}return t}function Vi(e){const t={};return e.addressModeU&&(t[10242]=Wt(e.addressModeU)),e.addressModeV&&(t[10243]=Wt(e.addressModeV)),e.addressModeW&&(t[32882]=Wt(e.addressModeW)),e.magFilter&&(t[10240]=Zt(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=eh(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Kt("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Wt(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Zt(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function eh(e,t="none"){if(!t)return Zt(e);switch(t){case"none":return Zt(e);case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class qt extends et{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=Vi(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,s]of Object.entries(t)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,s);break;default:this.device.gl.samplerParameteri(this.handle,i,s);break}}}}class Te extends or{device;gl;handle;texture;constructor(t,r){super(t,{...m.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const th="Failed to deduce GL constant from typed array";function rh(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(th)}}function sh(e,t){const{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ji(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function ih(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function lt(e,t,r){if(nh(t))return r(e);const{nocatch:s=!0}=t,i=ie.get(e);i.push(),Me(e,t);let n;if(s)n=r(e),i.pop();else try{n=r(e)}finally{i.pop()}return n}function nh(e){for(const t in e)return!1;return!0}function oh(e,t,r){const{dimension:s,width:i,height:n,depth:o=0}=r,{glInternalFormat:a}=r,c=r.glTarget;switch(s){case"2d-array":case"3d":e.texStorage3D(c,t,a,i,n,o);break;default:e.texStorage2D(c,t,a,i,n)}}function ys(e,t,r,s){const{width:i,height:n}=s,{dimension:o,depth:a=0,mipLevel:c=0}=s,{x:l=0,y:f=0,z:h=0}=s,{glFormat:_,glType:d}=s,u=zi(s.glTarget,o,a),g=s.flipY?{37440:!0}:{};lt(e,g,()=>{switch(o){case"2d-array":case"3d":e.bindTexture(u,t),e.texSubImage3D(u,c,l,f,h,i,n,a,_,d,r),e.bindTexture(u,null);break;case"2d":case"cube":e.bindTexture(u,t),e.texSubImage2D(u,c,l,f,i,n,_,d,r),e.bindTexture(u,null);break;default:throw new Error(o)}})}function Ps(e,t,r){const{dimension:s,width:i,height:n,depth:o=0,mipLevel:a=0,byteOffset:c=0}=r,{x:l=0,y:f=0,z:h=0}=r,{glFormat:_,glType:d,compressed:u}=r,g=zi(r.glTarget,s,o);switch(s){case"2d-array":case"3d":u?e.compressedTexSubImage3D(g,a,l,f,h,i,n,o,_,t,c):e.texSubImage3D(g,a,l,f,h,i,n,o,_,d,t,c);break;case"2d":case"cube":u?e.compressedTexSubImage2D(g,a,l,f,i,n,_,t,c):e.texSubImage2D(g,a,l,f,i,n,_,d,t,c);break;default:throw new Error(s)}}function ah(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}function zi(e,t,r){return t==="cube"?34069+r:e}function ch(e,t){const{sourceX:r=0,sourceY:s=0,sourceAttachment:i=0}=t||{};let{target:n=null,sourceWidth:o,sourceHeight:a,sourceDepth:c,sourceFormat:l,sourceType:f}=t||{};const{framebuffer:h,deleteFramebuffer:_}=$i(e),{gl:d,handle:u}=h;o||=h.width,a||=h.height;const g=h.colorAttachments[i]?.texture;if(!g)throw new Error(`Invalid framebuffer attachment ${i}`);c=g?.depth||1,l||=g?.glFormat||6408,f||=g?.glType||5121,n=hh(n,f,l,o,a),f=f||rh(n);const T=d.bindFramebuffer(36160,u);return d.readBuffer(36064+i),d.readPixels(r,s,o,a,l,f,n),d.readBuffer(36064),d.bindFramebuffer(36160,T||null),_&&h.destroy(),n}function lh(e,t){const{target:r,sourceX:s=0,sourceY:i=0,sourceFormat:n=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=t||{};const{framebuffer:f,deleteFramebuffer:h}=$i(e);a=a||f.width,c=c||f.height;const _=f;l=l||5121;let d=r;if(!d){const g=ji(n),T=ih(l),p=o+a*c*g*T;d=_.device.createBuffer({byteLength:p})}const u=e.device.createCommandEncoder();return u.copyTextureToBuffer({sourceTexture:e,width:a,height:c,origin:[s,i],destinationBuffer:d,byteOffset:o}),u.destroy(),h&&f.destroy(),d}function $i(e){return e instanceof _t?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:fh(e),deleteFramebuffer:!0}}function fh(e,t){const{device:r,width:s,height:i,id:n}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${n}`,width:s,height:i,colorAttachments:[e]})}function hh(e,t,r,s,i,n){if(e)return e;t||=5121;const o=sh(t,{clamped:!1}),a=ji(r);return new o(s*i*a)}class Ue extends m{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(t,r){super(t,r);const s={...this.props};s.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=ah(this.props.dimension);const i=Wi(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:s}=t;if(!r||!s){const i=m.getTextureDataSize(t.data);r=i?.width||1,s=i?.height||1}if(this.width=r,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Te(this.device,{...this.props,texture:this}),this.bind(),oh(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Te(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof qt?(this.sampler=t,r=t.props):(this.sampler=new qt(this.device,t),r=t);const s=Vi(r);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(S.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){S.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=m.getExternalImageSize(t.image),s={...m.defaultCopyExternalImageOptions,...r,...t},{image:i,depth:n,mipLevel:o,x:a,y:c,z:l,flipY:f}=s;let{width:h,height:_}=s;const{dimension:d,glTarget:u,glFormat:g,glInternalFormat:T,glType:p}=this;if(h=Math.min(h,this.width-a),_=Math.min(_,this.height-c),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return ys(this.device.gl,this.handle,i,{dimension:d,mipLevel:o,x:a,y:c,z:l,width:h,height:_,depth:n,glFormat:g,glType:p,glTarget:u,flipY:f}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const s=m.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&S.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<s.length;i++){const n=s[i];this._setMipLevel(r,i,n)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),Ps(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of m.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&S.warn(`${this.id} has mipmap and multiple LODs.`)();const i=m.CubeFaces.indexOf(r);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:s,height:i,pixels:n,data:o,format:a=6408,type:c=5121}=t,{gl:l}=this,f=n||o;this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},t,{face:r,data:h,pixels:h}))):this.width||this.height?l.texImage2D(r,0,a,s,i,0,a,c,f):l.texImage2D(r,0,a,a,c,f)}_getImageDataMap(t){for(let r=0;r<m.CubeFaces.length;++r){const s=m.CubeFaces[r];t[s]&&(t[34069+r]=t[s],delete t[s])}return t}_setSamplerParameters(t){S.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,s]of Object.entries(t)){const i=Number(r),n=s;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,n);break;case 10241:this.gl.texParameteri(this.glTarget,i,n);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,n);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,n);break;default:this.gl.texParameteri(this.glTarget,i,n);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,s,i=this.glTarget){if(m.isExternalImage(s)){ys(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:r,glTarget:i,flipY:this.props.flipY});return}if(m.isTextureLevelData(s)){Ps(this.device.gl,s.data,{...this,depth:t,mipLevel:r,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const _h=[1,2,4,8];class dh extends te{device;glParameters;constructor(t,r){super(t,r),this.device=t;let s;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:n,height:o}=r.framebuffer;s=[0,0,n,o]}else{const[n,o]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,n,o]}if(this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const n=this.props.framebuffer.colorAttachments.map((o,a)=>36064+a);this.device.gl.drawBuffers(n)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=_h.map(s=>!!(s&t.colorMask))),this.glParameters=r,Me(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((s,i)=>{s&&this.clearColorBuffer(i,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&lt(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){lt(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function uh(e){return gh.includes(e)}const gh=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Li={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Yi(e){const t=Li[e];if(!t)throw new Error("uniform");const[r,s,,i]=t;return{format:i,components:s,glType:r}}function Th(e){const t=Li[e];if(!t)throw new Error("attribute");const[,r,,s,i]=t;return{attributeType:s,vertexFormat:i,components:r}}function Ah(e,t){const r={attributes:[],bindings:[]};r.attributes=ph(e,t);const s=Sh(e,t);for(const a of s){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const i=Eh(e,t);let n=0;for(const a of i)if(uh(a.type)){const{viewDimension:c,sampleType:l}=Ch(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:n,viewDimension:c,sampleType:l}),a.textureUnit=n,n+=1}i.length&&(r.uniforms=i);const o=Rh(e,t);return o?.length&&(r.varyings=o),r}function ph(e,t){const r=[],s=e.getProgramParameter(t,35721);for(let i=0;i<s;i++){const n=e.getActiveAttrib(t,i);if(!n)throw new Error("activeInfo");const{name:o,type:a}=n,c=e.getAttribLocation(t,o);if(c>=0){const{attributeType:l}=Th(a),f=/instance/i.test(o)?"instance":"vertex";r.push({name:o,location:c,stepMode:f,type:l})}}return r.sort((i,n)=>i.location-n.location),r}function Rh(e,t){const r=[],s=e.getProgramParameter(t,35971);for(let i=0;i<s;i++){const n=e.getTransformFeedbackVarying(t,i);if(!n)throw new Error("activeInfo");const{name:o,type:a,size:c}=n,{glType:l,components:f}=Yi(a),h={location:i,name:o,type:l,size:c*f};r.push(h)}return r.sort((i,n)=>i.location-n.location),r}function Eh(e,t){const r=[],s=e.getProgramParameter(t,35718);for(let i=0;i<s;i++){const n=e.getActiveUniform(t,i);if(!n)throw new Error("activeInfo");const{name:o,size:a,type:c}=n,{name:l,isArray:f}=Mh(o);let h=e.getUniformLocation(t,l);const _={location:h,name:l,size:a,type:c,isArray:f};if(r.push(_),_.size>1)for(let d=0;d<_.size;d++){const u=`${l}[${d}]`;h=e.getUniformLocation(t,u);const g={..._,name:u,location:h};r.push(g)}}return r}function Sh(e,t){const r=(n,o)=>e.getActiveUniformBlockParameter(t,n,o),s=[],i=e.getProgramParameter(t,35382);for(let n=0;n<i;n++){const o={name:e.getActiveUniformBlockName(t,n)||"",location:r(n,35391),byteLength:r(n,35392),vertex:r(n,35396),fragment:r(n,35398),uniformCount:r(n,35394),uniforms:[]},a=r(n,35395)||[],c=e.getActiveUniforms(t,a,35383),l=e.getActiveUniforms(t,a,35384),f=e.getActiveUniforms(t,a,35387),h=e.getActiveUniforms(t,a,35388);for(let _=0;_<o.uniformCount;++_){const d=e.getActiveUniform(t,a[_]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:Yi(c[_]).format,type:c[_],arrayLength:l[_],byteOffset:f[_],byteStride:h[_]})}s.push(o)}return s.sort((n,o)=>n.location-o.location),s}const bh={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Ch(e){const t=bh[e];if(!t)throw new Error("sampler");const[r,s]=t;return{viewDimension:r,sampleType:s}}function Mh(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function Ih(e,t,r,s){const i=e;let n=s;n===!0&&(n=1),n===!1&&(n=0);const o=typeof n=="number"?[n]:n;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof s!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,s);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:return e.uniform1iv(t,o);case 35667:return e.uniform2iv(t,o);case 35668:return e.uniform3iv(t,o);case 35669:return e.uniform4iv(t,o);case 35670:return e.uniform1iv(t,o);case 35671:return e.uniform2iv(t,o);case 35672:return e.uniform3iv(t,o);case 35673:return e.uniform4iv(t,o);case 5125:return i.uniform1uiv(t,o,1);case 36294:return i.uniform2uiv(t,o,2);case 36295:return i.uniform3uiv(t,o,3);case 36296:return i.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return i.uniformMatrix2x3fv(t,!1,o);case 35686:return i.uniformMatrix2x4fv(t,!1,o);case 35687:return i.uniformMatrix3x2fv(t,!1,o);case 35688:return i.uniformMatrix3x4fv(t,!1,o);case 35689:return i.uniformMatrix4x2fv(t,!1,o);case 35690:return i.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function Nh(e){return of(e)!==null||typeof e=="number"||typeof e=="boolean"}function Oh(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{const s=e[r];Nh(s)?t.uniforms[r]=s:t.bindings[r]=s}),t}function yh(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function Ph(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}const Fs=4;class Fh extends cr{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:i=35981}=r;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,i)),this._linkShaders(),S.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Ah(this.device.gl,this.handle),S.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=mh(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[s,i]of Object.entries(t)){const n=this.shaderLayout.bindings.find(o=>o.name===s)||this.shaderLayout.bindings.find(o=>o.name===`${s}Uniforms`);if(!n){const o=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||S.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${o}`,i)();continue}switch(i||S.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),n.type){case"uniform":if(!(i instanceof xe)&&!(i.buffer instanceof xe))throw new Error("buffer value");break;case"texture":if(!(i instanceof Te||i instanceof Ue||i instanceof we))throw new Error("texture value");break;case"sampler":S.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(n.type)}this.bindings[s]=i}}draw(t){const{renderPass:r,parameters:s=this.props.parameters,topology:i=this.props.topology,vertexArray:n,vertexCount:o,instanceCount:a,isInstanced:c=!1,firstVertex:l=0,transformFeedback:f}=t,h=yh(i),_=!!n.indexBuffer,d=n.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return S.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return S.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),n.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const u=r;return Zf(this.device,s,u.glParameters,()=>{_&&c?this.device.gl.drawElementsInstanced(h,o||0,d,l,a||0):_?this.device.gl.drawElements(h,o||0,d,l):c?this.device.gl.drawArraysInstanced(h,l,o||0,a||0):this.device.gl.drawArrays(h,l,o||0),f&&f.end()}),n.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=Oh(t);Object.keys(r).forEach(s=>{S.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),S.time(Fs,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),S.timeEnd(Fs,`linkProgram for ${this.id}`)(),S.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}S.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),S.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${r}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async i=>await new Promise(n=>setTimeout(n,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(S.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,s=0;for(const i of this.shaderLayout.bindings){const n=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!n)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:o}=i,a=t.getUniformBlockIndex(this.handle,o);if(a===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,s,a),n instanceof xe?t.bindBufferBase(35345,s,n.handle):t.bindBufferRange(35345,s,n.buffer.handle,n.offset||0,n.size||n.buffer.byteLength-n.offset),s+=1;break;case"texture":if(!(n instanceof Te||n instanceof Ue||n instanceof we))throw new Error("texture");let c;if(n instanceof Te)c=n.texture;else if(n instanceof Ue)c=n;else if(n instanceof we&&n.colorAttachments[0]instanceof Te)S.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=n.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(c.glTarget,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:i,textureUnit:n}=t,o=this.uniforms[r]??n;o!==void 0&&Ih(this.device.gl,s,i,o)}}}function mh(e,t){const r={...e,attributes:e.attributes.map(s=>({...s}))};for(const s of t?.attributes||[]){const i=r.attributes.find(n=>n.name===s.name);i?(i.type=s.type||i.type,i.stepMode=s.stepMode||i.stepMode):S.warn(`shader layout attribute ${s.name} not present in shader`)}return r}class Dh extends fr{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":Bh(this.device,r.options);break;case"copy-buffer-to-texture":wh(this.device,r.options);break;case"copy-texture-to-buffer":xh(this.device,r.options);break;case"copy-texture-to-texture":Uh(this.device,r.options);break;default:throw new Error(r.name)}}}function Bh(e,t){const r=t.sourceBuffer,s=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,s.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function wh(e,t){throw new Error("Not implemented")}function xh(e,t){const{sourceTexture:r,mipLevel:s=0,aspect:i="all",width:n=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:c=[0,0],destinationBuffer:l,byteOffset:f=0,bytesPerRow:h,rowsPerImage:_}=t;if(i!=="all")throw new Error("aspect not supported in WebGL");if(s!==0||a!==0||h||_)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:u}=Ki(r);let g;try{const T=l,p=n||d.width,A=o||d.height,R=Wi(d.colorAttachments[0].texture.props.format),E=R.format,b=R.type;e.gl.bindBuffer(35051,T.handle),g=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(c[0],c[1],p,A,E,b,f)}finally{e.gl.bindBuffer(35051,null),g!==void 0&&e.gl.bindFramebuffer(36160,g),u&&d.destroy()}}function Uh(e,t){const{sourceTexture:r,destinationMipLevel:s=0,origin:i=[0,0],destinationOrigin:n=[0,0],destinationTexture:o}=t;let{width:a=t.destinationTexture.width,height:c=t.destinationTexture.height}=t;const{framebuffer:l,destroyFramebuffer:f}=Ki(r),[h,_]=i,[d,u,g]=n,T=e.gl.bindFramebuffer(36160,l.handle);let p=null,A;if(o instanceof Ue)p=o,a=Number.isFinite(a)?a:p.width,c=Number.isFinite(c)?c:p.height,p.bind(0),A=p.glTarget;else throw new Error("invalid destination");switch(A){case 3553:case 34067:e.gl.copyTexSubImage2D(A,s,d,u,h,_,a,c);break;case 35866:case 32879:e.gl.copyTexSubImage3D(A,s,d,u,g,h,_,a,c);break}p&&p.unbind(),e.gl.bindFramebuffer(36160,T),f&&l.destroy()}function Ki(e){if(e instanceof m){const{width:t,height:r,id:s}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${s}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class vh extends lr{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new Dh(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,s){}}function Wh(e){const{target:t,source:r,start:s=0,count:i=1}=e,n=r.length,o=i*n;let a=0;for(let c=s;a<n;a++)t[c++]=r[a];for(;a<o;)a<o-a?(t.copyWithin(s+a,s,s+a),a*=2):(t.copyWithin(s+a,s,s+o-a),a=o);return e.target}class pr extends hr{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return qi()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:n,stride:o,offset:a,normalized:c,integer:l,divisor:f}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),l?this.device.gl.vertexAttribIPointer(t,i,n,o,a):this.device.gl.vertexAttribPointer(t,i,n,c,o,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,f||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const s=vi(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const i=pr.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const s=kh(r),i=s.byteLength*t,n=s.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),o=o||!Hh(s,this.bufferValue),o){const a=ja(r.constructor,n);Wh({target:a,source:s,start:0,count:n}),this.buffer.write(a),this.bufferValue=r}return this.buffer}}function kh(e){return Array.isArray(e)?new Float32Array(e):e}function Hh(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}class Xh extends _r{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Ph(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const s=this._getVaryingIndex(t),{buffer:i,byteLength:n,byteOffset:o}=this._getBufferRange(r);if(s<0){this.unusedBuffers[t]=i,S.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:i,byteLength:n,byteOffset:o},this.bindOnUse||this._bindBuffer(s,i,o,n)}getBuffer(t){if(ms(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof xe)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:s=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:s,byteLength:i}}_getVaryingIndex(t){if(ms(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:s,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,s=0,i){const n=r&&r.handle;!n||i===void 0?this.gl.bindBufferBase(35982,t,n):this.gl.bindBufferRange(35982,t,n,s,i)}}function ms(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}class Vh extends dr{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,i)=>{const n=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}}class N_ extends Ge{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(t){super({...t,id:t.id||zf("webgl-device")});const r=Ge._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=r.canvas?.gl?.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new xf(this,r),this.lost=new Promise(f=>{this._resolveContextLost=f});const i={...t.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),t.powerPreference!==void 0&&(i.powerPreference=t.powerPreference);const o=this.props._handle||gf(this.canvasContext.canvas,{onContextLost:f=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:f=>console.log("WebGL context restored")},i);if(!o)throw new Error("WebGL context creation failed");if(s=o.device,s){if(t._reuseDevices)return S.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=o,this.gl=o,this.spectorJS=vf({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Tf(this.gl,this._extensions),this.limits=new Df(this.gl),this.features=new mf(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new ie(this.gl,{log:(...f)=>S.log(1,...f)()}).trackState(this.gl,{copyState:!1});const c=t.debugWebGL||t.debug,l=t.debugWebGL;c&&(this.gl=kf(this.gl,{debugWebGL:c,traceWebGL:l}),S.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(S.level=Math.max(S.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new xe(this,r)}createTexture(t){return new Ue(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new qt(this,t)}createShader(t){return new Kf(this,t)}createFramebuffer(t){return new we(this,t)}createVertexArray(t){return new pr(this,t)}createTransformFeedback(t){return new Xh(this,t)}createQuerySet(t){return new Vh(this,t)}createRenderPipeline(t){return new Fh(this,t)}beginRenderPass(t){return new dh(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t={}){return new vh(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return ch(t,r)}readPixelsToBufferWebGL(t,r){return lh(t,r)}setParametersWebGL(t){Me(this.gl,t)}getParametersWebGL(t){return xi(this.gl,t)}withParametersWebGL(t,r){return lt(this.gl,t,r)}resetWebGL(){S.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),ff(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return Of(this.gl,t,this._extensions)}loseDevice(){let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){ie.get(this.gl).push()}popState(){ie.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const s=Number(t);for(const i in this.gl)if(this.gl[i]===s)return`GL.${i}`;return r?.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[i,n])=>(s[`${i}:${this.getGLKey(i,r)}`]=`${n}:${this.getGLKey(n,r)}`,s),{})}_constants;setConstantAttributeWebGL(t,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const i=this._constants[t];switch(i&&Lh(i,r)&&S.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:jh(this,t,r);break;case Int32Array:zh(this,t,r);break;case Uint32Array:$h(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return be(this.gl,t,this._extensions),this._extensions}}function jh(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break}}function zh(e,t,r){e.gl.vertexAttribI4iv(t,r)}function $h(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function Lh(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}export{zc as $,p_ as A,$ as B,v as C,R_ as D,T_ as E,A_ as F,zl as G,N_ as H,Kh as I,E_ as J,Ds as K,d_ as L,Rr as M,Zh as N,Yh as O,g_ as P,Ge as Q,y as R,ar as S,or as T,it as U,aa as V,ct as W,Ce as X,$c as Y,Lc as Z,Yc as _,Xl as a,r_ as a0,t_ as a1,i_ as a2,M as a3,Si as a4,hl as a5,n_ as a6,l_ as a7,Fi as a8,ut as a9,Ee as aa,K as ab,oe as ac,Bi as ad,Vc as ae,mn as af,gt as ag,rt as ah,tt as ai,o_ as aj,Hi as ak,I_ as al,M_ as am,a_ as an,fs as ao,Di as ap,at as aq,e_ as ar,Qh as as,Gh as at,Fc as au,f_ as av,ot as aw,wt as ax,Sl as b,cr as c,ei as d,Pe as e,m as f,Va as g,et as h,of as i,wa as j,Zl as k,S as l,h_ as m,rr as n,C_ as o,c_ as p,S_ as q,b_ as r,Jh as s,dt as t,Al as u,__ as v,qh as w,La as x,gs as y,u_ as z};
